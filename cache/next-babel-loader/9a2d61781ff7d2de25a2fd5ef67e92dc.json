{"ast":null,"code":"var _jsxFileName = \"C:\\\\newlife\\\\newSite\\\\my-app\\\\pages\\\\release-article.js\";\nimport _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nimport React, { useEffect, useState } from \"react\";\nimport Head from \"next/head\";\nimport Nav from \"../component/release-article/nav\";\nimport Author from \"../component/release-article/author\";\nimport ArtContent from \"../component/release-article/articleContent\";\nimport About from \"../component/release-article/about\";\nimport Footer from \"../component/release-article/footer\";\nimport { useRouter } from \"next/router\";\n\nconst Home = () => {\n  const uploadData = async data => {\n    try {\n      const QURL = process.env.DATA_URL + \"addArticle/add\";\n      let res = await fetch(QURL, {\n        method: \"POST\",\n        body: data\n      });\n      let result = await res.json();\n\n      if (res.ok) {\n        let keys = Object.keys(localStorage);\n\n        for (let key of keys) {\n          if (key !== \"author-name\" && key !== \"article-key\") {\n            localStorage.removeItem(key);\n          }\n        }\n\n        let openRequest = indexedDB.open(\"article-store\", 2);\n\n        openRequest.onsuccess = async () => {\n          let db = openRequest.result;\n          let tx = db.transaction(\"photoBuffer\", \"readwrite\");\n          let store = tx.objectStore(\"photoBuffer\");\n          let keys = store.getAllKeys();\n\n          keys.onsuccess = () => {\n            keys.result.map(key => {\n              if (key !== \"article-author-photo\") {\n                store.delete(key);\n                console.log(\"delete\");\n              }\n            });\n            window.location.reload();\n          };\n        };\n      } else {\n        alert(result);\n      }\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const submitForm = e => {\n    e.preventDefault();\n    let data = new FormData(e.target);\n    let content = localStorage.getItem(\"article-content-object\");\n    let fileList = JSON.parse(content).filter(item => item.type === \"photo\");\n    fileList.push({\n      key: \"article-author-photo\"\n    });\n    let openRequest = indexedDB.open(\"article-store\", 2);\n\n    openRequest.onsuccess = async () => {\n      let db = openRequest.result;\n      let tx = db.transaction(\"photoBuffer\");\n      let store = tx.objectStore(\"photoBuffer\");\n      let reqs = fileList.map(item => new Promise((resolve, reject) => {\n        let photo = store.get(item.key);\n\n        photo.onsuccess = () => {\n          if (photo.result) {\n            resolve({\n              file: photo.result.file,\n              name: item.key\n            });\n          } else {\n            reject(\"有一个图片板块没有文件。请上传或是删除点这个板块\");\n          }\n        };\n      }));\n      Promise.all(reqs).then(items => {\n        items.map(item => {\n          data.append(item.name, item.file);\n        });\n        data.append(\"article-content-main\", content);\n        data.append(\"link-count\", LinkList.length);\n        uploadData(data);\n      }).catch(alert);\n    };\n  };\n\n  const {\n    0: LinkList,\n    1: setLinkList\n  } = useState([\"a\"]);\n  return __jsx(React.Fragment, null, __jsx(Head, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 7\n    }\n  }, __jsx(\"title\", {\n    className: \"jsx-680210942\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 9\n    }\n  }, \"\\u7F16\\u5199\\u6587\\u7AE0\"), __jsx(\"link\", {\n    rel: \"stylesheet\",\n    href: \"https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css\",\n    integrity: \"sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh\",\n    crossorigin: \"anonymous\",\n    className: \"jsx-680210942\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 9\n    }\n  }), __jsx(\"link\", {\n    rel: \"stylesheet\",\n    href: \"//at.alicdn.com/t/font_1748919_7p01375xskx.css\",\n    className: \"jsx-680210942\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 9\n    }\n  }), __jsx(\"link\", {\n    rel: \"icon\",\n    href: \"/logo.jpg\",\n    type: \"image/x-icon\",\n    className: \"jsx-680210942\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 9\n    }\n  })), __jsx(\"div\", {\n    className: \"jsx-680210942\" + \" \" + \"container-fluid\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 7\n    }\n  }, __jsx(\"nav\", {\n    className: \"jsx-680210942\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 9\n    }\n  }, __jsx(Nav, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 11\n    }\n  })), __jsx(\"form\", {\n    onSubmit: submitForm,\n    className: \"jsx-680210942\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 9\n    }\n  }, __jsx(Author, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 11\n    }\n  }), __jsx(ArtContent, {\n    setLinkList: setLinkList,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 11\n    }\n  }), __jsx(About, {\n    List: LinkList,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 11\n    }\n  })), __jsx(Footer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 9\n    }\n  })), __jsx(_JSXStyle, {\n    id: \"680210942\",\n    __self: this\n  }, \"*,body{margin:0;padding:0;box-sizing:border-box;}html{font-size:10px;}.container-fluid{padding:0;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxuZXdsaWZlXFxuZXdTaXRlXFxteS1hcHBcXHBhZ2VzXFxyZWxlYXNlLWFydGljbGUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBOEh5QixBQUlvQixBQUtNLEFBR0wsU0FQQSxDQVFaLEtBSEEsSUFKd0Isc0JBQ3hCIiwiZmlsZSI6IkM6XFxuZXdsaWZlXFxuZXdTaXRlXFxteS1hcHBcXHBhZ2VzXFxyZWxlYXNlLWFydGljbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgdXNlRWZmZWN0LCB1c2VTdGF0ZSB9IGZyb20gXCJyZWFjdFwiO1xyXG5cclxuaW1wb3J0IEhlYWQgZnJvbSBcIm5leHQvaGVhZFwiO1xyXG5pbXBvcnQgTmF2IGZyb20gXCIuLi9jb21wb25lbnQvcmVsZWFzZS1hcnRpY2xlL25hdlwiO1xyXG5pbXBvcnQgQXV0aG9yIGZyb20gXCIuLi9jb21wb25lbnQvcmVsZWFzZS1hcnRpY2xlL2F1dGhvclwiO1xyXG5pbXBvcnQgQXJ0Q29udGVudCBmcm9tIFwiLi4vY29tcG9uZW50L3JlbGVhc2UtYXJ0aWNsZS9hcnRpY2xlQ29udGVudFwiO1xyXG5pbXBvcnQgQWJvdXQgZnJvbSBcIi4uL2NvbXBvbmVudC9yZWxlYXNlLWFydGljbGUvYWJvdXRcIjtcclxuaW1wb3J0IEZvb3RlciBmcm9tIFwiLi4vY29tcG9uZW50L3JlbGVhc2UtYXJ0aWNsZS9mb290ZXJcIjtcclxuaW1wb3J0IHsgdXNlUm91dGVyIH0gZnJvbSBcIm5leHQvcm91dGVyXCI7XHJcblxyXG5jb25zdCBIb21lID0gKCkgPT4ge1xyXG4gIGNvbnN0IHVwbG9hZERhdGEgPSBhc3luYyAoZGF0YSkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgUVVSTCA9IHByb2Nlc3MuZW52LkRBVEFfVVJMICsgXCJhZGRBcnRpY2xlL2FkZFwiO1xyXG4gICAgICBsZXQgcmVzID0gYXdhaXQgZmV0Y2goUVVSTCwge1xyXG4gICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICAgICAgYm9keTogZGF0YSxcclxuICAgICAgfSk7XHJcbiAgICAgIGxldCByZXN1bHQgPSBhd2FpdCByZXMuanNvbigpO1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgbGV0IGtleXMgPSBPYmplY3Qua2V5cyhsb2NhbFN0b3JhZ2UpO1xyXG4gICAgICAgIGZvciAobGV0IGtleSBvZiBrZXlzKSB7XHJcbiAgICAgICAgICBpZiAoa2V5ICE9PSBcImF1dGhvci1uYW1lXCIgJiYga2V5ICE9PSBcImFydGljbGUta2V5XCIpIHtcclxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oa2V5KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IG9wZW5SZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oXCJhcnRpY2xlLXN0b3JlXCIsIDIpO1xyXG4gICAgICAgIG9wZW5SZXF1ZXN0Lm9uc3VjY2VzcyA9IGFzeW5jICgpID0+IHtcclxuICAgICAgICAgIGxldCBkYiA9IG9wZW5SZXF1ZXN0LnJlc3VsdDtcclxuICAgICAgICAgIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKFwicGhvdG9CdWZmZXJcIiwgXCJyZWFkd3JpdGVcIik7XHJcbiAgICAgICAgICBsZXQgc3RvcmUgPSB0eC5vYmplY3RTdG9yZShcInBob3RvQnVmZmVyXCIpO1xyXG4gICAgICAgICAgbGV0IGtleXMgPSBzdG9yZS5nZXRBbGxLZXlzKCk7XHJcbiAgICAgICAgICBrZXlzLm9uc3VjY2VzcyA9ICgpID0+IHtcclxuICAgICAgICAgICAga2V5cy5yZXN1bHQubWFwKChrZXkpID0+IHtcclxuICAgICAgICAgICAgICBpZiAoa2V5ICE9PSBcImFydGljbGUtYXV0aG9yLXBob3RvXCIpIHtcclxuICAgICAgICAgICAgICAgIHN0b3JlLmRlbGV0ZShrZXkpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJkZWxldGVcIik7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xyXG4gICAgICAgICAgfTtcclxuICAgICAgICB9O1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGFsZXJ0KHJlc3VsdCk7XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIGNvbnN0IHN1Ym1pdEZvcm0gPSAoZSkgPT4ge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgbGV0IGRhdGEgPSBuZXcgRm9ybURhdGEoZS50YXJnZXQpO1xyXG4gICAgbGV0IGNvbnRlbnQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImFydGljbGUtY29udGVudC1vYmplY3RcIik7XHJcblxyXG4gICAgbGV0IGZpbGVMaXN0ID0gSlNPTi5wYXJzZShjb250ZW50KS5maWx0ZXIoKGl0ZW0pID0+IGl0ZW0udHlwZSA9PT0gXCJwaG90b1wiKTtcclxuICAgIGZpbGVMaXN0LnB1c2goe1xyXG4gICAgICBrZXk6IFwiYXJ0aWNsZS1hdXRob3ItcGhvdG9cIixcclxuICAgIH0pO1xyXG4gICAgbGV0IG9wZW5SZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oXCJhcnRpY2xlLXN0b3JlXCIsIDIpO1xyXG4gICAgb3BlblJlcXVlc3Qub25zdWNjZXNzID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgICBsZXQgZGIgPSBvcGVuUmVxdWVzdC5yZXN1bHQ7XHJcbiAgICAgIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKFwicGhvdG9CdWZmZXJcIik7XHJcbiAgICAgIGxldCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKFwicGhvdG9CdWZmZXJcIik7XHJcbiAgICAgIGxldCByZXFzID0gZmlsZUxpc3QubWFwKFxyXG4gICAgICAgIChpdGVtKSA9PlxyXG4gICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgcGhvdG8gPSBzdG9yZS5nZXQoaXRlbS5rZXkpO1xyXG4gICAgICAgICAgICBwaG90by5vbnN1Y2Nlc3MgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgaWYgKHBob3RvLnJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSh7XHJcbiAgICAgICAgICAgICAgICAgIGZpbGU6IHBob3RvLnJlc3VsdC5maWxlLFxyXG4gICAgICAgICAgICAgICAgICBuYW1lOiBpdGVtLmtleSxcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZWplY3QoXCLmnInkuIDkuKrlm77niYfmnb/lnZfmsqHmnInmlofku7bjgILor7fkuIrkvKDmiJbmmK/liKDpmaTngrnov5nkuKrmnb/lnZdcIik7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgfSlcclxuICAgICAgKTtcclxuICAgICAgUHJvbWlzZS5hbGwocmVxcylcclxuICAgICAgICAudGhlbigoaXRlbXMpID0+IHtcclxuICAgICAgICAgIGl0ZW1zLm1hcCgoaXRlbSkgPT4ge1xyXG4gICAgICAgICAgICBkYXRhLmFwcGVuZChpdGVtLm5hbWUsIGl0ZW0uZmlsZSk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIGRhdGEuYXBwZW5kKFwiYXJ0aWNsZS1jb250ZW50LW1haW5cIiwgY29udGVudCk7XHJcbiAgICAgICAgICBkYXRhLmFwcGVuZChcImxpbmstY291bnRcIiwgTGlua0xpc3QubGVuZ3RoKTtcclxuICAgICAgICAgIHVwbG9hZERhdGEoZGF0YSk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goYWxlcnQpO1xyXG4gICAgfTtcclxuICB9O1xyXG5cclxuICBjb25zdCBbTGlua0xpc3QsIHNldExpbmtMaXN0XSA9IHVzZVN0YXRlKFtcImFcIl0pO1xyXG5cclxuICByZXR1cm4gKFxyXG4gICAgPD5cclxuICAgICAgPEhlYWQ+XHJcbiAgICAgICAgPHRpdGxlPue8luWGmeaWh+eroDwvdGl0bGU+XHJcbiAgICAgICAgPGxpbmtcclxuICAgICAgICAgIHJlbD1cInN0eWxlc2hlZXRcIlxyXG4gICAgICAgICAgaHJlZj1cImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vYm9vdHN0cmFwQDQuNC4xL2Rpc3QvY3NzL2Jvb3RzdHJhcC5taW4uY3NzXCJcclxuICAgICAgICAgIGludGVncml0eT1cInNoYTM4NC1Wa29vOHg0Q0dzTzMrSGh4djhUL1E1UGFYdGtLdHU2dWc1VE9lTlY2Z0JpRmVXUEdGTjlNdWhPZjIzUTlJZmpoXCJcclxuICAgICAgICAgIGNyb3Nzb3JpZ2luPVwiYW5vbnltb3VzXCJcclxuICAgICAgICA+PC9saW5rPlxyXG4gICAgICAgIDxsaW5rXHJcbiAgICAgICAgICByZWw9XCJzdHlsZXNoZWV0XCJcclxuICAgICAgICAgIGhyZWY9XCIvL2F0LmFsaWNkbi5jb20vdC9mb250XzE3NDg5MTlfN3AwMTM3NXhza3guY3NzXCJcclxuICAgICAgICAvPlxyXG4gICAgICAgIDxsaW5rIHJlbD1cImljb25cIiBocmVmPVwiL2xvZ28uanBnXCIgdHlwZT1cImltYWdlL3gtaWNvblwiPjwvbGluaz5cclxuICAgICAgPC9IZWFkPlxyXG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cImNvbnRhaW5lci1mbHVpZFwiPlxyXG4gICAgICAgIDxuYXY+XHJcbiAgICAgICAgICA8TmF2IC8+XHJcbiAgICAgICAgPC9uYXY+XHJcbiAgICAgICAgPGZvcm0gb25TdWJtaXQ9e3N1Ym1pdEZvcm19PlxyXG4gICAgICAgICAgPEF1dGhvciAvPlxyXG5cclxuICAgICAgICAgIDxBcnRDb250ZW50IHNldExpbmtMaXN0PXtzZXRMaW5rTGlzdH0gLz5cclxuXHJcbiAgICAgICAgICA8QWJvdXQgTGlzdD17TGlua0xpc3R9IC8+XHJcbiAgICAgICAgPC9mb3JtPlxyXG5cclxuICAgICAgICA8Rm9vdGVyIC8+XHJcbiAgICAgIDwvZGl2PlxyXG5cclxuICAgICAgPHN0eWxlIGpzeCBnbG9iYWw+e2BcclxuICAgICAgICAqLFxyXG4gICAgICAgIGJvZHkge1xyXG4gICAgICAgICAgbWFyZ2luOiAwO1xyXG4gICAgICAgICAgcGFkZGluZzogMDtcclxuICAgICAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGh0bWwge1xyXG4gICAgICAgICAgZm9udC1zaXplOiAxMHB4O1xyXG4gICAgICAgIH1cclxuICAgICAgICAuY29udGFpbmVyLWZsdWlkIHtcclxuICAgICAgICAgIHBhZGRpbmc6IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICBgfTwvc3R5bGU+XHJcbiAgICA8Lz5cclxuICApO1xyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgSG9tZTtcclxuIl19 */\\n/*@ sourceURL=C:\\\\\\\\newlife\\\\\\\\newSite\\\\\\\\my-app\\\\\\\\pages\\\\\\\\release-article.js */\"));\n};\n\nexport default Home;","map":{"version":3,"sources":["C:/newlife/newSite/my-app/pages/release-article.js"],"names":["React","useEffect","useState","Head","Nav","Author","ArtContent","About","Footer","useRouter","Home","uploadData","data","QURL","process","env","DATA_URL","res","fetch","method","body","result","json","ok","keys","Object","localStorage","key","removeItem","openRequest","indexedDB","open","onsuccess","db","tx","transaction","store","objectStore","getAllKeys","map","delete","console","log","window","location","reload","alert","err","submitForm","e","preventDefault","FormData","target","content","getItem","fileList","JSON","parse","filter","item","type","push","reqs","Promise","resolve","reject","photo","get","file","name","all","then","items","append","LinkList","length","catch","setLinkList"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\r\n\r\nimport Head from \"next/head\";\r\nimport Nav from \"../component/release-article/nav\";\r\nimport Author from \"../component/release-article/author\";\r\nimport ArtContent from \"../component/release-article/articleContent\";\r\nimport About from \"../component/release-article/about\";\r\nimport Footer from \"../component/release-article/footer\";\r\nimport { useRouter } from \"next/router\";\r\n\r\nconst Home = () => {\r\n  const uploadData = async (data) => {\r\n    try {\r\n      const QURL = process.env.DATA_URL + \"addArticle/add\";\r\n      let res = await fetch(QURL, {\r\n        method: \"POST\",\r\n        body: data,\r\n      });\r\n      let result = await res.json();\r\n      if (res.ok) {\r\n        let keys = Object.keys(localStorage);\r\n        for (let key of keys) {\r\n          if (key !== \"author-name\" && key !== \"article-key\") {\r\n            localStorage.removeItem(key);\r\n          }\r\n        }\r\n        let openRequest = indexedDB.open(\"article-store\", 2);\r\n        openRequest.onsuccess = async () => {\r\n          let db = openRequest.result;\r\n          let tx = db.transaction(\"photoBuffer\", \"readwrite\");\r\n          let store = tx.objectStore(\"photoBuffer\");\r\n          let keys = store.getAllKeys();\r\n          keys.onsuccess = () => {\r\n            keys.result.map((key) => {\r\n              if (key !== \"article-author-photo\") {\r\n                store.delete(key);\r\n                console.log(\"delete\");\r\n              }\r\n            });\r\n            window.location.reload();\r\n          };\r\n        };\r\n      } else {\r\n        alert(result);\r\n      }\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n\r\n  const submitForm = (e) => {\r\n    e.preventDefault();\r\n    let data = new FormData(e.target);\r\n    let content = localStorage.getItem(\"article-content-object\");\r\n\r\n    let fileList = JSON.parse(content).filter((item) => item.type === \"photo\");\r\n    fileList.push({\r\n      key: \"article-author-photo\",\r\n    });\r\n    let openRequest = indexedDB.open(\"article-store\", 2);\r\n    openRequest.onsuccess = async () => {\r\n      let db = openRequest.result;\r\n      let tx = db.transaction(\"photoBuffer\");\r\n      let store = tx.objectStore(\"photoBuffer\");\r\n      let reqs = fileList.map(\r\n        (item) =>\r\n          new Promise((resolve, reject) => {\r\n            let photo = store.get(item.key);\r\n            photo.onsuccess = () => {\r\n              if (photo.result) {\r\n                resolve({\r\n                  file: photo.result.file,\r\n                  name: item.key,\r\n                });\r\n              } else {\r\n                reject(\"有一个图片板块没有文件。请上传或是删除点这个板块\");\r\n              }\r\n            };\r\n          })\r\n      );\r\n      Promise.all(reqs)\r\n        .then((items) => {\r\n          items.map((item) => {\r\n            data.append(item.name, item.file);\r\n          });\r\n          data.append(\"article-content-main\", content);\r\n          data.append(\"link-count\", LinkList.length);\r\n          uploadData(data);\r\n        })\r\n        .catch(alert);\r\n    };\r\n  };\r\n\r\n  const [LinkList, setLinkList] = useState([\"a\"]);\r\n\r\n  return (\r\n    <>\r\n      <Head>\r\n        <title>编写文章</title>\r\n        <link\r\n          rel=\"stylesheet\"\r\n          href=\"https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css\"\r\n          integrity=\"sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh\"\r\n          crossorigin=\"anonymous\"\r\n        ></link>\r\n        <link\r\n          rel=\"stylesheet\"\r\n          href=\"//at.alicdn.com/t/font_1748919_7p01375xskx.css\"\r\n        />\r\n        <link rel=\"icon\" href=\"/logo.jpg\" type=\"image/x-icon\"></link>\r\n      </Head>\r\n      <div className=\"container-fluid\">\r\n        <nav>\r\n          <Nav />\r\n        </nav>\r\n        <form onSubmit={submitForm}>\r\n          <Author />\r\n\r\n          <ArtContent setLinkList={setLinkList} />\r\n\r\n          <About List={LinkList} />\r\n        </form>\r\n\r\n        <Footer />\r\n      </div>\r\n\r\n      <style jsx global>{`\r\n        *,\r\n        body {\r\n          margin: 0;\r\n          padding: 0;\r\n          box-sizing: border-box;\r\n        }\r\n        html {\r\n          font-size: 10px;\r\n        }\r\n        .container-fluid {\r\n          padding: 0;\r\n        }\r\n      `}</style>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Home;\r\n"]},"metadata":{},"sourceType":"module"}