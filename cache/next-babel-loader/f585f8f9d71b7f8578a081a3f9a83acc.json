{"ast":null,"code":"var _jsxFileName = \"C:\\\\newlife\\\\newSite\\\\my-app\\\\pages\\\\release-article.js\";\nimport _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nimport React, { useEffect, useState } from 'react';\nimport Head from 'next/head';\nimport Nav from '../component/release-article/nav';\nimport Author from '../component/release-article/author';\nimport ArtContent from '../component/release-article/articleContent';\nimport About from '../component/release-article/about';\nimport Footer from '../component/release-article/footer';\nimport { useRouter } from 'next/router';\n\nconst Home = () => {\n  let {\n    key\n  } = useRouter().query; //设置发布的钥匙串\n\n  useEffect(() => {\n    if (key) localStorage.setItem('article-key', key);\n  }, []);\n\n  const uploadData = async data => {\n    try {\n      const QURL = process.env.DATA_URL + 'addArticle/add';\n      let res = await fetch(QURL, {\n        method: 'POST',\n        body: data\n      });\n      let result = await res.json();\n\n      if (res.ok) {\n        let keys = Object.keys(localStorage);\n\n        for (let key of keys) {\n          if (key !== 'author-name' && key !== 'article-key') {\n            localStorage.removeItem(key);\n          }\n        }\n\n        let openRequest = indexedDB.open('article-store', 2);\n\n        openRequest.onsuccess = async () => {\n          let db = openRequest.result;\n          let tx = db.transaction('photoBuffer', 'readwrite');\n          let store = tx.objectStore('photoBuffer');\n          let keys = store.getAllKeys();\n\n          keys.onsuccess = () => {\n            keys.result.map(key => {\n              if (key !== 'article-author-photo') {\n                store.delete(key);\n                console.log('delete');\n              }\n            });\n            window.location.reload();\n          };\n        };\n      } else {\n        alert(result);\n      }\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const submitForm = e => {\n    e.preventDefault();\n    let data = new FormData(e.target);\n    let content = localStorage.getItem('article-content-object');\n    let fileList = JSON.parse(content).filter(item => item.type === 'photo');\n    fileList.push({\n      key: 'article-author-photo'\n    });\n    let openRequest = indexedDB.open('article-store', 2);\n\n    openRequest.onsuccess = async () => {\n      let db = openRequest.result;\n      let tx = db.transaction('photoBuffer');\n      let store = tx.objectStore('photoBuffer');\n      let reqs = fileList.map(item => new Promise((resolve, reject) => {\n        let photo = store.get(item.key);\n\n        photo.onsuccess = () => {\n          if (photo.result) {\n            resolve({\n              file: photo.result.file,\n              name: item.key\n            });\n          } else {\n            reject('有一个图片板块没有文件。请上传或是删除点这个板块');\n          }\n        };\n      }));\n      Promise.all(reqs).then(items => {\n        items.map(item => {\n          data.append(item.name, item.file);\n        });\n        data.append('article-content-main', content);\n        data.append('link-count', LinkList.length);\n        uploadData(data);\n      }).catch(alert);\n    };\n  };\n\n  const {\n    0: LinkList,\n    1: setLinkList\n  } = useState(['a']);\n  return __jsx(React.Fragment, null, __jsx(Head, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 6\n    }\n  }, __jsx(\"title\", {\n    className: \"jsx-1864912321\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 7\n    }\n  }, \"Create Next App\"), __jsx(\"link\", {\n    rel: \"stylesheet\",\n    href: \"https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css\",\n    integrity: \"sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh\",\n    crossorigin: \"anonymous\",\n    className: \"jsx-1864912321\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 7\n    }\n  }), __jsx(\"link\", {\n    rel: \"stylesheet\",\n    href: \"//at.alicdn.com/t/font_1748919_7p01375xskx.css\",\n    className: \"jsx-1864912321\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 7\n    }\n  }), __jsx(\"link\", {\n    rel: \"icon\",\n    href: \"/logo.jpg\",\n    type: \"image/x-icon\",\n    className: \"jsx-1864912321\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 7\n    }\n  })), __jsx(\"div\", {\n    className: \"jsx-1864912321\" + \" \" + \"container-fluid\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 6\n    }\n  }, __jsx(\"nav\", {\n    className: \"jsx-1864912321\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 9\n    }\n  }, __jsx(Nav, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 15\n    }\n  })), __jsx(\"form\", {\n    onSubmit: submitForm,\n    className: \"jsx-1864912321\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 9\n    }\n  }, __jsx(Author, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 11\n    }\n  }), __jsx(ArtContent, {\n    setLinkList: setLinkList,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 11\n    }\n  }), __jsx(About, {\n    List: LinkList,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 11\n    }\n  })), __jsx(Footer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 9\n    }\n  })), __jsx(_JSXStyle, {\n    id: \"1864912321\",\n    __self: this\n  }, \"*,body{margin:0;padding:0;box-sizing:border-box;}html{font-size:10px;}.container-fluid{padding:0;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxuZXdsaWZlXFxuZXdTaXRlXFxteS1hcHBcXHBhZ2VzXFxyZWxlYXNlLWFydGljbGUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBaUl1QixBQUdvQixBQUtLLEFBR0wsU0FQQyxDQVFaLEtBSEEsSUFKd0Isc0JBQ3ZCIiwiZmlsZSI6IkM6XFxuZXdsaWZlXFxuZXdTaXRlXFxteS1hcHBcXHBhZ2VzXFxyZWxlYXNlLWFydGljbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3Qse3VzZUVmZmVjdCAsIHVzZVN0YXRlfSBmcm9tICdyZWFjdCdcclxuXHJcbmltcG9ydCBIZWFkIGZyb20gJ25leHQvaGVhZCdcclxuaW1wb3J0IE5hdiBmcm9tICcuLi9jb21wb25lbnQvcmVsZWFzZS1hcnRpY2xlL25hdidcclxuaW1wb3J0IEF1dGhvciBmcm9tICcuLi9jb21wb25lbnQvcmVsZWFzZS1hcnRpY2xlL2F1dGhvcidcclxuaW1wb3J0IEFydENvbnRlbnQgZnJvbSAnLi4vY29tcG9uZW50L3JlbGVhc2UtYXJ0aWNsZS9hcnRpY2xlQ29udGVudCdcclxuaW1wb3J0IEFib3V0IGZyb20gJy4uL2NvbXBvbmVudC9yZWxlYXNlLWFydGljbGUvYWJvdXQnXHJcbmltcG9ydCBGb290ZXIgZnJvbSAnLi4vY29tcG9uZW50L3JlbGVhc2UtYXJ0aWNsZS9mb290ZXInXHJcbmltcG9ydCB7dXNlUm91dGVyIH0gZnJvbSAnbmV4dC9yb3V0ZXInXHJcblxyXG5jb25zdCBIb21lID0gKCkgPT4ge1xyXG4gIGxldCB7IGtleSB9ID0gdXNlUm91dGVyKCkucXVlcnk7ICAgICAgICAgICAgIC8v6K6+572u5Y+R5biD55qE6ZKl5YyZ5LiyXHJcbiAgdXNlRWZmZWN0KCgpID0+IHsgICAgICAgICBcclxuICAgICAgICBpZihrZXkpIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdhcnRpY2xlLWtleScsa2V5KTtcclxuICB9LFtdKVxyXG4gIGNvbnN0IHVwbG9hZERhdGEgPSBhc3luYyAoZGF0YSkgPT4geyAgICAgICAgIFxyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBRVVJMID0gcHJvY2Vzcy5lbnYuREFUQV9VUkwgKyAnYWRkQXJ0aWNsZS9hZGQnIFxyXG4gICAgICAgIGxldCByZXMgPSBhd2FpdCBmZXRjaChRVVJMLHtcclxuICAgICAgICAgICAgbWV0aG9kOidQT1NUJyxcclxuICAgICAgICAgICAgYm9keTpkYXRhLFxyXG4gICAgICAgIH0pICAgICAgICAgXHJcbiAgICAgICAgbGV0IHJlc3VsdCA9IGF3YWl0ICByZXMuanNvbigpOyAgICBcclxuICAgICAgICBpZihyZXMub2spIHsgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICBsZXQga2V5cyA9IE9iamVjdC5rZXlzKGxvY2FsU3RvcmFnZSk7XHJcbiAgICAgICAgICBmb3IobGV0IGtleSBvZiBrZXlzKSB7ICAgICAgXHJcbiAgICAgICAgICAgICBpZihrZXkgIT09ICdhdXRob3ItbmFtZScgJiYga2V5ICE9PSAnYXJ0aWNsZS1rZXknKXtcclxuICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGtleSlcclxuICAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0gICAgICAgICAgXHJcbiAgICAgICAgICAgIGxldCBvcGVuUmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKCdhcnRpY2xlLXN0b3JlJywyKVxyXG4gICAgICAgICAgICBvcGVuUmVxdWVzdC5vbnN1Y2Nlc3MgPWFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgICBsZXQgZGIgPSBvcGVuUmVxdWVzdC5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Bob3RvQnVmZmVyJywncmVhZHdyaXRlJyk7XHJcbiAgICAgICAgICAgICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Bob3RvQnVmZmVyJyk7XHJcbiAgICAgICAgICAgICAgbGV0IGtleXMgPXN0b3JlLmdldEFsbEtleXMoKTtcclxuICAgICAgICAgICAgICBrZXlzLm9uc3VjY2VzcyA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGtleXMucmVzdWx0Lm1hcCgga2V5ID0+IHtcclxuICAgICAgICAgICAgICAgICAgaWYoa2V5ICE9PSAnYXJ0aWNsZS1hdXRob3ItcGhvdG8nKXtcclxuICAgICAgICAgICAgICAgICAgICBzdG9yZS5kZWxldGUoa2V5KSAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2RlbGV0ZScpO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpXHJcbiAgICAgICAgICAgICAgfSAgIFxyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1lbHNleyAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgYWxlcnQocmVzdWx0KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1jYXRjaChlcnIpIHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICAgIH0gICAgXHJcbiAgfVxyXG5cclxuXHJcbiAgY29uc3Qgc3VibWl0Rm9ybSA9IChlKSA9PiB7XHJcbiAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgbGV0IGRhdGEgPSBuZXcgRm9ybURhdGEoZS50YXJnZXQpO1xyXG4gICAgICAgICBsZXQgY29udGVudCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdhcnRpY2xlLWNvbnRlbnQtb2JqZWN0Jyk7XHJcblxyXG4gICAgICAgICBsZXQgZmlsZUxpc3QgPSBKU09OLnBhcnNlKGNvbnRlbnQpLmZpbHRlcihpdGVtID0+IGl0ZW0udHlwZSA9PT0gJ3Bob3RvJyk7IFxyXG4gICAgICAgICBmaWxlTGlzdC5wdXNoKHtcclxuICAgICAgICAgICAga2V5OidhcnRpY2xlLWF1dGhvci1waG90bydcclxuICAgICAgICAgIH0pICAgICAgICBcclxuICAgICAgICAgbGV0IG9wZW5SZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oJ2FydGljbGUtc3RvcmUnLDIpXHJcbiAgICAgICAgIG9wZW5SZXF1ZXN0Lm9uc3VjY2VzcyA9YXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgZGIgPSBvcGVuUmVxdWVzdC5yZXN1bHQ7XHJcbiAgICAgICAgICAgIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdwaG90b0J1ZmZlcicpXHJcbiAgICAgICAgICAgIGxldCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdwaG90b0J1ZmZlcicpXHJcbiAgICAgICAgICAgIGxldCByZXFzID0gIGZpbGVMaXN0Lm1hcCggaXRlbSA9PiBuZXcgUHJvbWlzZShcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAocmVzb2x2ZSxyZWplY3QpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwaG90byA9IHN0b3JlLmdldChpdGVtLmtleSkgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBob3RvLm9uc3VjY2VzcyA9ICgpID0+IHsgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHBob3RvLnJlc3VsdCkgeyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZTpwaG90by5yZXN1bHQuZmlsZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOml0ZW0ua2V5LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2V7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KCfmnInkuIDkuKrlm77niYfmnb/lnZfmsqHmnInmlofku7bjgILor7fkuIrkvKDmiJbmmK/liKDpmaTngrnov5nkuKrmnb/lnZcnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICBQcm9taXNlLmFsbChyZXFzKS50aGVuKCBpdGVtcyA9PiB7XHJcbiAgICAgICAgICAgICAgICBpdGVtcy5tYXAoIGl0ZW0gPT4geyAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgIGRhdGEuYXBwZW5kKGl0ZW0ubmFtZSxpdGVtLmZpbGUpfSlcclxuICAgICAgICAgICAgICAgIGRhdGEuYXBwZW5kKCdhcnRpY2xlLWNvbnRlbnQtbWFpbicsY29udGVudCk7XHJcbiAgICAgICAgICAgICAgICBkYXRhLmFwcGVuZCgnbGluay1jb3VudCcsTGlua0xpc3QubGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgIHVwbG9hZERhdGEoZGF0YSk7ICAgICAgXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApLmNhdGNoKGFsZXJ0KSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgIH0gICAgICAgICBcclxuICAgICAgICBcclxuICAgICAgICBcclxuICB9XHJcbiAgXHJcblxyXG5cclxuICBjb25zdCBbTGlua0xpc3QsIHNldExpbmtMaXN0XSA9IHVzZVN0YXRlKFsnYSddKVxyXG4gIFxyXG4gIHJldHVybiggIFxyXG4gIDw+XHJcbiAgICAgPEhlYWQ+XHJcbiAgICAgIDx0aXRsZT5DcmVhdGUgTmV4dCBBcHA8L3RpdGxlPiAgICAgIFxyXG4gICAgICA8bGluayByZWw9XCJzdHlsZXNoZWV0XCIgaHJlZj1cImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vYm9vdHN0cmFwQDQuNC4xL2Rpc3QvY3NzL2Jvb3RzdHJhcC5taW4uY3NzXCIgaW50ZWdyaXR5PVwic2hhMzg0LVZrb284eDRDR3NPMytIaHh2OFQvUTVQYVh0a0t0dTZ1ZzVUT2VOVjZnQmlGZVdQR0ZOOU11aE9mMjNROUlmamhcIiBjcm9zc29yaWdpbj1cImFub255bW91c1wiPjwvbGluaz5cclxuICAgICAgPGxpbmsgcmVsPVwic3R5bGVzaGVldFwiIGhyZWY9XCIvL2F0LmFsaWNkbi5jb20vdC9mb250XzE3NDg5MTlfN3AwMTM3NXhza3guY3NzXCIvPlxyXG4gICAgICA8bGluayByZWw9XCJpY29uXCIgaHJlZj1cIi9sb2dvLmpwZ1wiIHR5cGU9XCJpbWFnZS94LWljb25cIj48L2xpbms+XHJcbiAgICA8L0hlYWQ+ICAgXHJcbiAgICAgPGRpdiBjbGFzc05hbWU9XCJjb250YWluZXItZmx1aWRcIj4gICBcclxuICAgICAgICA8bmF2ID4gICAgICAgICBcclxuICAgICAgICAgICAgICA8TmF2Lz4gICAgICAgICAgICAgXHJcbiAgICAgICAgPC9uYXY+ICAgICAgXHJcbiAgICAgICAgPGZvcm0gb25TdWJtaXQ9e3N1Ym1pdEZvcm19PlxyXG4gICAgICAgICAgPEF1dGhvci8+XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIDxBcnRDb250ZW50IHNldExpbmtMaXN0PXtzZXRMaW5rTGlzdH0vPlxyXG4gICAgICAgICAgXHJcbiAgICAgICAgICA8QWJvdXQgTGlzdD17TGlua0xpc3R9Lz5cclxuXHJcbiAgICAgICAgPC9mb3JtPlxyXG4gICBcclxuXHJcbiAgICAgICAgPEZvb3Rlci8+XHJcblxyXG4gICAgIDwvZGl2PlxyXG5cclxuICAgIDxzdHlsZSBqc3ggZ2xvYmFsPntgXHJcbiAgICAgICAgICosYm9keXtcclxuICAgICAgICAgICBtYXJnaW46MDtcclxuICAgICAgICAgICBwYWRkaW5nOjA7XHJcbiAgICAgICAgICAgYm94LXNpemluZzpib3JkZXItYm94O1xyXG4gICAgICAgICB9ICAgXHJcbiAgICAgICAgaHRtbCB7XHJcbiAgICAgICAgICBmb250LXNpemU6MTBweDtcclxuICAgICAgICB9XHJcbiAgICAgICAgLmNvbnRhaW5lci1mbHVpZHtcclxuICAgICAgICAgIHBhZGRpbmc6MDtcclxuICAgICAgICB9IFxyXG4gICAgYH08L3N0eWxlPlxyXG4gICAgXHJcbiAgPC8+XHJcbil9XHJcblxyXG5leHBvcnQgZGVmYXVsdCBIb21lXHJcbiJdfQ== */\\n/*@ sourceURL=C:\\\\\\\\newlife\\\\\\\\newSite\\\\\\\\my-app\\\\\\\\pages\\\\\\\\release-article.js */\"));\n};\n\nexport default Home;","map":{"version":3,"sources":["C:/newlife/newSite/my-app/pages/release-article.js"],"names":["React","useEffect","useState","Head","Nav","Author","ArtContent","About","Footer","useRouter","Home","key","query","localStorage","setItem","uploadData","data","QURL","process","env","DATA_URL","res","fetch","method","body","result","json","ok","keys","Object","removeItem","openRequest","indexedDB","open","onsuccess","db","tx","transaction","store","objectStore","getAllKeys","map","delete","console","log","window","location","reload","alert","err","submitForm","e","preventDefault","FormData","target","content","getItem","fileList","JSON","parse","filter","item","type","push","reqs","Promise","resolve","reject","photo","get","file","name","all","then","items","append","LinkList","length","catch","setLinkList"],"mappings":"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","sourcesContent":["import React,{useEffect , useState} from 'react'\r\n\r\nimport Head from 'next/head'\r\nimport Nav from '../component/release-article/nav'\r\nimport Author from '../component/release-article/author'\r\nimport ArtContent from '../component/release-article/articleContent'\r\nimport About from '../component/release-article/about'\r\nimport Footer from '../component/release-article/footer'\r\nimport {useRouter } from 'next/router'\r\n\r\nconst Home = () => {\r\n  let { key } = useRouter().query;             //设置发布的钥匙串\r\n  useEffect(() => {         \r\n        if(key) localStorage.setItem('article-key',key);\r\n  },[])\r\n  const uploadData = async (data) => {         \r\n    try {\r\n        const QURL = process.env.DATA_URL + 'addArticle/add' \r\n        let res = await fetch(QURL,{\r\n            method:'POST',\r\n            body:data,\r\n        })         \r\n        let result = await  res.json();    \r\n        if(res.ok) {                \r\n          let keys = Object.keys(localStorage);\r\n          for(let key of keys) {      \r\n             if(key !== 'author-name' && key !== 'article-key'){\r\n                localStorage.removeItem(key)\r\n             }\r\n          }          \r\n            let openRequest = indexedDB.open('article-store',2)\r\n            openRequest.onsuccess =async () => {\r\n              let db = openRequest.result;\r\n              let tx = db.transaction('photoBuffer','readwrite');\r\n              let store = tx.objectStore('photoBuffer');\r\n              let keys =store.getAllKeys();\r\n              keys.onsuccess = () => {\r\n                keys.result.map( key => {\r\n                  if(key !== 'article-author-photo'){\r\n                    store.delete(key)                    \r\n                    console.log('delete');\r\n                  }\r\n                })\r\n                window.location.reload()\r\n              }   \r\n\r\n            }\r\n        }else{                \r\n            alert(result);\r\n        }\r\n      }catch(err) {\r\n          console.log(err);\r\n      }    \r\n  }\r\n\r\n\r\n  const submitForm = (e) => {\r\n         e.preventDefault();\r\n         let data = new FormData(e.target);\r\n         let content = localStorage.getItem('article-content-object');\r\n\r\n         let fileList = JSON.parse(content).filter(item => item.type === 'photo'); \r\n         fileList.push({\r\n            key:'article-author-photo'\r\n          })        \r\n         let openRequest = indexedDB.open('article-store',2)\r\n         openRequest.onsuccess =async () => {\r\n            let db = openRequest.result;\r\n            let tx = db.transaction('photoBuffer')\r\n            let store = tx.objectStore('photoBuffer')\r\n            let reqs =  fileList.map( item => new Promise(\r\n                                                  (resolve,reject) => {\r\n                                                    let photo = store.get(item.key)            \r\n                                                    photo.onsuccess = () => {                \r\n                                                      if(photo.result) {                                                                              \r\n                                                          resolve({\r\n                                                           file:photo.result.file,\r\n                                                           name:item.key,\r\n                                                          })\r\n                                                      }else{                                                                                    \r\n                                                        reject('有一个图片板块没有文件。请上传或是删除点这个板块')\r\n                                                      }                                                                    \r\n                                                    }\r\n                                                  }\r\n                                                )                                \r\n                                           )\r\n            Promise.all(reqs).then( items => {\r\n                items.map( item => {                      \r\n                      data.append(item.name,item.file)})\r\n                data.append('article-content-main',content);\r\n                data.append('link-count',LinkList.length);\r\n                uploadData(data);      \r\n              }\r\n            ).catch(alert)                                                   \r\n        }         \r\n        \r\n        \r\n  }\r\n  \r\n\r\n\r\n  const [LinkList, setLinkList] = useState(['a'])\r\n  \r\n  return(  \r\n  <>\r\n     <Head>\r\n      <title>Create Next App</title>      \r\n      <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css\" integrity=\"sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh\" crossorigin=\"anonymous\"></link>\r\n      <link rel=\"stylesheet\" href=\"//at.alicdn.com/t/font_1748919_7p01375xskx.css\"/>\r\n      <link rel=\"icon\" href=\"/logo.jpg\" type=\"image/x-icon\"></link>\r\n    </Head>   \r\n     <div className=\"container-fluid\">   \r\n        <nav >         \r\n              <Nav/>             \r\n        </nav>      \r\n        <form onSubmit={submitForm}>\r\n          <Author/>\r\n          \r\n          <ArtContent setLinkList={setLinkList}/>\r\n          \r\n          <About List={LinkList}/>\r\n\r\n        </form>\r\n   \r\n\r\n        <Footer/>\r\n\r\n     </div>\r\n\r\n    <style jsx global>{`\r\n         *,body{\r\n           margin:0;\r\n           padding:0;\r\n           box-sizing:border-box;\r\n         }   \r\n        html {\r\n          font-size:10px;\r\n        }\r\n        .container-fluid{\r\n          padding:0;\r\n        } \r\n    `}</style>\r\n    \r\n  </>\r\n)}\r\n\r\nexport default Home\r\n"]},"metadata":{},"sourceType":"module"}