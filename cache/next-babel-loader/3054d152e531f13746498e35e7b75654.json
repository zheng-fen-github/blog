{"ast":null,"code":"var _jsxFileName = \"C:\\\\newlife\\\\newSite\\\\my-app\\\\component\\\\release-article\\\\photo.js\";\nimport _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nimport React, { useState, useEffect } from 'react';\n\nconst Photo = ({\n  name,\n  index,\n  setState,\n  title,\n  state\n}) => {\n  const {\n    0: File,\n    1: setFile\n  } = useState(null);\n\n  const clickEv = e => {\n    e.currentTarget.nextElementSibling.click();\n  };\n\n  useEffect(() => {\n    let openRequest = indexedDB.open('article-store', 2);\n\n    openRequest.onupgradeneeded = () => {\n      let db = openRequest.result;\n\n      if (!db.objectStoreNames.contains('photoBuffer')) {\n        db.createObjectStore('photoBuffer', {\n          keyPath: 'name'\n        });\n      }\n    };\n\n    openRequest.onsuccess = async () => {\n      let db = openRequest.result;\n      let tx = db.transaction('photoBuffer', 'readwrite');\n      let store = tx.objectStore('photoBuffer');\n      let photo = store.get(name);\n\n      photo.onsuccess = () => {\n        if (photo.result) {\n          setFile(URL.createObjectURL(photo.result.file));\n        }\n      };\n    };\n\n    return () => {\n      URL.revokeObjectURL(File);\n    };\n  }, []);\n\n  const fileUp = e => {\n    let file = e.target.files[0];\n    let src = URL.createObjectURL(file);\n    setFile(src);\n    let openRequest = indexedDB.open('article-store', 2);\n\n    openRequest.onsuccess = () => {\n      let DB = openRequest.result;\n      let transaction = DB.transaction('photoBuffer', 'readwrite');\n      let store = transaction.objectStore(\"photoBuffer\"); // (2)\n\n      let bufferItem = {\n        name,\n        file,\n        create: new Date()\n      };\n      let req = store.add(bufferItem);\n\n      req.onsuccess = () => {\n        console.log('存图片buffer 成功');\n        console.log(req.result);\n      };\n\n      req.onerror = () => {\n        console.log('存图片buffer 失败');\n        console.log(req.error);\n      };\n    };\n  };\n\n  const clearFile = e => {\n    //清楚file文件\n    setFile(null);\n    e.currentTarget.nextElementSibling.value = '';\n  };\n\n  const changValue = e => {\n    // 更改图片标题事件\n    let oldValue = localStorage.getItem('article-content-object');\n    if (!oldValue) return;\n    let mianData = JSON.parse(oldValue); // 根据输入的值 更新状态和localstorage！！\n\n    mianData[index].title = e.target.value;\n    localStorage.setItem('article-content-object', JSON.stringify(mianData));\n    setState(mianData);\n  };\n\n  const deleteEv = index => {\n    let newList = state.filter((e, Cindex) => Cindex !== index);\n    setState(newList);\n    localStorage.setItem('article-content-object', JSON.stringify(newList));\n    let openRequest = indexedDB.open('article-store', 2);\n\n    openRequest.onsuccess = () => {\n      let DB = openRequest.result;\n      let transaction = DB.transaction('photoBuffer', 'readwrite');\n      let store = transaction.objectStore(\"photoBuffer\"); // (2)              \n\n      let req = store.delete(name);\n\n      req.onsuccess = () => {\n        console.log(name + 'delete 成功');\n      };\n\n      req.onerror = () => {\n        console.log(name + 'delete 失败');\n        console.log(req.error);\n      };\n    };\n  };\n\n  return __jsx(\"div\", {\n    className: \"jsx-2814629420\" + \" \" + \"row content-item position-relative\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 9\n    }\n  }, __jsx(\"input\", {\n    type: \"text\",\n    name: \"photo-title\",\n    onChange: changValue,\n    onInput: changValue,\n    defaultValue: title ? title : null,\n    required: true,\n    className: \"jsx-2814629420\" + \" \" + 'px-4 text-center',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 13\n    }\n  }), File ? __jsx(\"img\", {\n    src: File,\n    alt: \"content-photo\",\n    onDoubleClick: clearFile,\n    className: \"jsx-2814629420\" + \" \" + 'col-12 photo',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 22\n    }\n  }) : __jsx(\"div\", {\n    onClick: clickEv,\n    className: \"jsx-2814629420\" + \" \" + ' uploadRoot col-6 offset-3 d-flex justify-content-center align-items-center',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 112\n    }\n  }, __jsx(\"i\", {\n    className: \"jsx-2814629420\" + \" \" + 'iconfont icon-cloud-upload',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 40\n    }\n  })), __jsx(\"input\", {\n    type: \"file\",\n    name: name + 'file',\n    id: name + 'file',\n    onChange: fileUp,\n    className: \"jsx-2814629420\" + \" \" + 'd-none',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 13\n    }\n  }), __jsx(\"div\", {\n    onClick: () => deleteEv(index),\n    className: \"jsx-2814629420\" + \" \" + \"delete\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 13\n    }\n  }, __jsx(\"i\", {\n    className: \"jsx-2814629420\" + \" \" + 'iconfont icon-trash-',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 21\n    }\n  })), __jsx(_JSXStyle, {\n    id: \"2814629420\",\n    __self: this\n  }, \".content-item.jsx-2814629420{margin-bottom:5rem;}img.jsx-2814629420{width:100%;}.photo.jsx-2814629420{margin-bottom:3rem;}input[name='photo-title'].jsx-2814629420{height:6vh;width:50%;margin:0 auto;font-size:3rem;line-height:2;margin-bottom:5rem;}.uploadRoot.jsx-2814629420{height:20vh;}i.jsx-2814629420{font-size:8rem;height:8rem;cursor:pointer;-webkit-transition:.2s;transition:.2s;}i.jsx-2814629420:hover{font-size:9rem;height:9rem;}.delete.jsx-2814629420{position:absolute;right:-50px;top:50%;}.delete.jsx-2814629420 i.jsx-2814629420{background:none;color:black;font-size:2rem;}.delete.jsx-2814629420 i.jsx-2814629420:hover{background:black;color:white;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxuZXdsaWZlXFxuZXdTaXRlXFxteS1hcHBcXGNvbXBvbmVudFxccmVsZWFzZS1hcnRpY2xlXFxwaG90by5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFtSHlCLEFBR3NDLEFBR1IsQUFHUyxBQUdULEFBU0MsQUFHRyxBQU1ILEFBSU0sQUFNQSxBQUtBLFdBdENyQixBQU1hLENBU2IsR0FHZSxBQU1BLENBVUUsQ0FLQSxDQVhGLENBL0JmLEFBTUEsRUFJaUIsTUFZQyxBQU1sQixDQVVvQixDQUtwQixDQVhXLEtBckJPLEdBdUJsQixJQVhrQixDQWdCbEIsT0EzQmlCLGNBQ0ssZ0JBV3RCLEdBVEEiLCJmaWxlIjoiQzpcXG5ld2xpZmVcXG5ld1NpdGVcXG15LWFwcFxcY29tcG9uZW50XFxyZWxlYXNlLWFydGljbGVcXHBob3RvLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LHt1c2VTdGF0ZSx1c2VFZmZlY3R9IGZyb20gJ3JlYWN0J1xyXG5cclxuY29uc3QgUGhvdG8gPSAoeyBuYW1lLCBpbmRleCwgc2V0U3RhdGUsIHRpdGxlLCBzdGF0ZX0pID0+IHsgICAgXHJcbiAgICBcclxuXHJcbiAgICBjb25zdCBbRmlsZSwgc2V0RmlsZV0gPSB1c2VTdGF0ZShudWxsKVxyXG5cclxuICAgIGNvbnN0IGNsaWNrRXYgPSAoZSkgPT4ge1xyXG4gICAgICAgZS5jdXJyZW50VGFyZ2V0Lm5leHRFbGVtZW50U2libGluZy5jbGljaygpXHJcbiAgICB9XHJcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgICAgIGxldCBvcGVuUmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKCdhcnRpY2xlLXN0b3JlJywyKVxyXG4gICAgICAgIG9wZW5SZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9ICgpID0+IHtcclxuICAgICAgICAgICAgbGV0IGRiID0gb3BlblJlcXVlc3QucmVzdWx0O1xyXG4gICAgICAgICAgICBpZiAoIWRiLm9iamVjdFN0b3JlTmFtZXMuY29udGFpbnMoJ3Bob3RvQnVmZmVyJykpIHtcclxuICAgICAgICAgICAgICAgIGRiLmNyZWF0ZU9iamVjdFN0b3JlKCdwaG90b0J1ZmZlcicsIHtrZXlQYXRoOiAnbmFtZSd9KTtcclxuICAgICAgICAgICAgICB9ICAgICAgICAgICAgXHJcbiAgICAgICAgfSAgICAgXHJcbiAgICAgICAgb3BlblJlcXVlc3Qub25zdWNjZXNzID1hc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBkYiA9IG9wZW5SZXF1ZXN0LnJlc3VsdDtcclxuICAgICAgICAgICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Bob3RvQnVmZmVyJywncmVhZHdyaXRlJylcclxuICAgICAgICAgICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Bob3RvQnVmZmVyJylcclxuICAgICAgICAgICAgbGV0IHBob3RvID0gc3RvcmUuZ2V0KG5hbWUpICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHBob3RvLm9uc3VjY2VzcyA9ICgpID0+IHsgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZihwaG90by5yZXN1bHQpIHsgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHNldEZpbGUoVVJMLmNyZWF0ZU9iamVjdFVSTChwaG90by5yZXN1bHQuZmlsZSkpO1xyXG4gICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH0gICAgICAgICAgICBcclxuICAgICAgICB9IFxyXG5cclxuICAgICAgICByZXR1cm4gKCkgPT4ge1xyXG4gICAgICAgICAgICBVUkwucmV2b2tlT2JqZWN0VVJMKEZpbGUpO1xyXG4gICAgICAgIH1cclxuICAgIH0sW10pXHJcblxyXG4gICAgY29uc3QgZmlsZVVwID0gKGUpID0+IHsgICAgICAgICAgICBcclxuICAgICAgICAgICAgbGV0IGZpbGUgPSBlLnRhcmdldC5maWxlc1swXTtcclxuICAgICAgICAgICAgbGV0IHNyYyA9IFVSTC5jcmVhdGVPYmplY3RVUkwoZmlsZSk7XHJcbiAgICAgICAgICAgIHNldEZpbGUoc3JjKVxyXG4gICAgICAgICAgICBsZXQgb3BlblJlcXVlc3QgPSBpbmRleGVkREIub3BlbignYXJ0aWNsZS1zdG9yZScsMilcclxuICAgICAgICAgICAgb3BlblJlcXVlc3Qub25zdWNjZXNzID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IERCID0gb3BlblJlcXVlc3QucmVzdWx0OyAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGxldCB0cmFuc2FjdGlvbiAgPSAgREIudHJhbnNhY3Rpb24oJ3Bob3RvQnVmZmVyJywncmVhZHdyaXRlJyk7XHJcbiAgICAgICAgICAgICAgICBsZXQgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShcInBob3RvQnVmZmVyXCIpOyAvLyAoMilcclxuICAgICAgICAgICAgICAgIGxldCBidWZmZXJJdGVtID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIG5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgZmlsZSxcclxuICAgICAgICAgICAgICAgICAgICBjcmVhdGU6bmV3IERhdGUoKSxcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGxldCByZXEgPSBzdG9yZS5hZGQoYnVmZmVySXRlbSk7XHJcbiAgICAgICAgICAgICAgICByZXEub25zdWNjZXNzID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCflrZjlm77niYdidWZmZXIg5oiQ5YqfJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVxLnJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXEub25lcnJvciA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn5a2Y5Zu+54mHYnVmZmVyIOWksei0pScpOyAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVxLmVycm9yKTtcclxuICAgICAgICAgICAgICAgIH0gICAgICAgICAgIFxyXG4gICAgICAgICAgICB9ICAgICAgICAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgY2xlYXJGaWxlID0gKGUpID0+IHsgICAgICAgICAgLy/muIXmpZpmaWxl5paH5Lu2XHJcbiAgICAgICAgc2V0RmlsZShudWxsKTtcclxuICAgICAgICBlLmN1cnJlbnRUYXJnZXQubmV4dEVsZW1lbnRTaWJsaW5nLnZhbHVlID0gJyc7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgY2hhbmdWYWx1ZSA9IChlKSA9PiB7ICAgICAgLy8g5pu05pS55Zu+54mH5qCH6aKY5LqL5Lu2XHJcbiAgICAgICAgbGV0IG9sZFZhbHVlID0gICAgbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2FydGljbGUtY29udGVudC1vYmplY3QnKSA7ICAgXHJcbiAgICAgICAgaWYoIW9sZFZhbHVlKSByZXR1cm4gIFxyXG4gICAgICAgIGxldCBtaWFuRGF0YSA9IEpTT04ucGFyc2Uob2xkVmFsdWUpICAgICAgICAgICAgICAgICAgLy8g5qC55o2u6L6T5YWl55qE5YC8IOabtOaWsOeKtuaAgeWSjGxvY2Fsc3RvcmFnZe+8ge+8gVxyXG4gICAgICAgIG1pYW5EYXRhW2luZGV4XS50aXRsZSA9IGUudGFyZ2V0LnZhbHVlOyAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2FydGljbGUtY29udGVudC1vYmplY3QnLEpTT04uc3RyaW5naWZ5KG1pYW5EYXRhKSkgO1xyXG4gICAgICAgIHNldFN0YXRlKG1pYW5EYXRhKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBkZWxldGVFdiA9IChpbmRleCkgPT4geyAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICBsZXQgbmV3TGlzdCA9IHN0YXRlLmZpbHRlciggKGUsQ2luZGV4KSA9PiBDaW5kZXggIT09IGluZGV4KVxyXG4gICAgICAgICAgc2V0U3RhdGUobmV3TGlzdCk7XHJcbiAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnYXJ0aWNsZS1jb250ZW50LW9iamVjdCcsSlNPTi5zdHJpbmdpZnkobmV3TGlzdCkpO1xyXG5cclxuICAgICAgICAgIGxldCBvcGVuUmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKCdhcnRpY2xlLXN0b3JlJywyKSAgICAgICAgICBcclxuICAgICAgICAgIG9wZW5SZXF1ZXN0Lm9uc3VjY2VzcyA9ICgpID0+IHtcclxuICAgICAgICAgICAgICBsZXQgREIgPSBvcGVuUmVxdWVzdC5yZXN1bHQ7ICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgIGxldCB0cmFuc2FjdGlvbiAgPSAgREIudHJhbnNhY3Rpb24oJ3Bob3RvQnVmZmVyJywncmVhZHdyaXRlJyk7XHJcbiAgICAgICAgICAgICAgbGV0IHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoXCJwaG90b0J1ZmZlclwiKTsgLy8gKDIpICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICBsZXQgcmVxID0gc3RvcmUuZGVsZXRlKG5hbWUpO1xyXG4gICAgICAgICAgICAgIHJlcS5vbnN1Y2Nlc3MgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKG5hbWUgKyAnZGVsZXRlIOaIkOWKnycpOyAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICByZXEub25lcnJvciA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cobmFtZSArICdkZWxldGUg5aSx6LSlJyk7XHJcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlcS5lcnJvcik7XHJcbiAgICAgICAgICAgICAgfSAgICAgICAgICAgXHJcbiAgICAgICAgICB9ICAgICAgICAgICAgICAgXHJcbiAgICB9XHJcbiAgICBcclxuXHJcbiAgICByZXR1cm4gKFxyXG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwicm93IGNvbnRlbnQtaXRlbSBwb3NpdGlvbi1yZWxhdGl2ZVwiID5cclxuICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJ0ZXh0XCIgbmFtZT1cInBob3RvLXRpdGxlXCJcclxuICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9e2NoYW5nVmFsdWV9IFxyXG4gICAgICAgICAgICAgICAgICBvbklucHV0PXtjaGFuZ1ZhbHVlfVxyXG4gICAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU9e3RpdGxlPyB0aXRsZSA6IG51bGx9IFxyXG4gICAgICAgICAgICAgICAgICByZXF1aXJlZFxyXG4gICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPSdweC00IHRleHQtY2VudGVyJy8+ICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgIEZpbGUgPyA8aW1nIHNyYz17RmlsZX0gYWx0PVwiY29udGVudC1waG90b1wiIGNsYXNzTmFtZT0nY29sLTEyIHBob3RvJyBvbkRvdWJsZUNsaWNrPXtjbGVhckZpbGV9Lz46IDxkaXYgb25DbGljaz17Y2xpY2tFdn0gXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0nIHVwbG9hZFJvb3QgY29sLTYgb2Zmc2V0LTMgZC1mbGV4IGp1c3RpZnktY29udGVudC1jZW50ZXIgYWxpZ24taXRlbXMtY2VudGVyJz4gXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzTmFtZT0naWNvbmZvbnQgaWNvbi1jbG91ZC11cGxvYWQnPjwvaT5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgIH0gICAgICAgICAgICBcclxuICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJmaWxlXCIgbmFtZT17bmFtZSArICdmaWxlJ30gaWQ9e25hbWUgKyAnZmlsZSd9IGNsYXNzTmFtZT0nZC1ub25lJyBvbkNoYW5nZT17ZmlsZVVwfS8+XHJcbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZGVsZXRlXCIgb25DbGljaz17KCkgPT4gZGVsZXRlRXYoaW5kZXgpfT5cclxuICAgICAgICAgICAgICAgICAgICA8aSBjbGFzc05hbWU9J2ljb25mb250IGljb24tdHJhc2gtJz48L2k+XHJcbiAgICAgICAgICAgIDwvZGl2PiBcclxuICAgICAgICAgICAgPHN0eWxlIGpzeD4ge2BcclxuICAgICAgICAgICAgLmNvbnRlbnQtaXRlbSB7XHJcbiAgICAgICAgICAgICAgICAgICBtYXJnaW4tYm90dG9tOjVyZW07XHJcbiAgICAgICAgICAgICAgIH0gICAgXHJcbiAgICAgICAgICAgICAgIGltZyB7XHJcbiAgICAgICAgICAgICAgICAgICB3aWR0aDoxMDAlOyAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAucGhvdG8ge1xyXG4gICAgICAgICAgICAgICAgICAgIG1hcmdpbi1ib3R0b206M3JlbTtcclxuICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICBpbnB1dFtuYW1lPSdwaG90by10aXRsZSddIHtcclxuICAgICAgICAgICAgICAgICAgIGhlaWdodDo2dmg7XHJcbiAgICAgICAgICAgICAgICAgICB3aWR0aDo1MCU7XHJcbiAgICAgICAgICAgICAgICAgICBtYXJnaW46MCBhdXRvO1xyXG4gICAgICAgICAgICAgICAgICAgZm9udC1zaXplOjNyZW07XHJcbiAgICAgICAgICAgICAgICAgICBsaW5lLWhlaWdodDoyO1xyXG4gICAgICAgICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTo1cmVtO1xyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAudXBsb2FkUm9vdCB7XHJcbiAgICAgICAgICAgICAgICAgICBoZWlnaHQ6MjB2aDsgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgaSB7XHJcbiAgICAgICAgICAgICAgICAgICBmb250LXNpemU6OHJlbTtcclxuICAgICAgICAgICAgICAgICAgIGhlaWdodDo4cmVtO1xyXG4gICAgICAgICAgICAgICAgICAgY3Vyc29yOnBvaW50ZXI7XHJcbiAgICAgICAgICAgICAgICAgICB0cmFuc2l0aW9uOi4ycztcclxuICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICBpOmhvdmVyIHtcclxuICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTo5cmVtO1xyXG4gICAgICAgICAgICAgICAgICAgaGVpZ2h0OjlyZW07XHJcbiAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgLmRlbGV0ZSB7XHJcbiAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjphYnNvbHV0ZTtcclxuICAgICAgICAgICAgICAgICAgIHJpZ2h0Oi01MHB4O1xyXG4gICAgICAgICAgICAgICAgICAgdG9wOjUwJTtcclxuICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICB9IFxyXG4gICAgICAgICAgICAgICAuZGVsZXRlIGkge1xyXG4gICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOm5vbmU7XHJcbiAgICAgICAgICAgICAgICAgICAgIGNvbG9yOmJsYWNrOyAgXHJcbiAgICAgICAgICAgICAgICAgICAgIGZvbnQtc2l6ZToycmVtOyAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAuZGVsZXRlIGk6aG92ZXIge1xyXG4gICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6YmxhY2s7XHJcbiAgICAgICAgICAgICAgICAgICAgIGNvbG9yOndoaXRlOyAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBgfVxyXG4gICAgICAgICAgICA8L3N0eWxlPlxyXG4gICAgICAgIDwvZGl2PlxyXG4gICAgKVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBQaG90b1xyXG4iXX0= */\\n/*@ sourceURL=C:\\\\\\\\newlife\\\\\\\\newSite\\\\\\\\my-app\\\\\\\\component\\\\\\\\release-article\\\\\\\\photo.js */\"));\n};\n\nexport default Photo;","map":{"version":3,"sources":["C:/newlife/newSite/my-app/component/release-article/photo.js"],"names":["React","useState","useEffect","Photo","name","index","setState","title","state","File","setFile","clickEv","e","currentTarget","nextElementSibling","click","openRequest","indexedDB","open","onupgradeneeded","db","result","objectStoreNames","contains","createObjectStore","keyPath","onsuccess","tx","transaction","store","objectStore","photo","get","URL","createObjectURL","file","revokeObjectURL","fileUp","target","files","src","DB","bufferItem","create","Date","req","add","console","log","onerror","error","clearFile","value","changValue","oldValue","localStorage","getItem","mianData","JSON","parse","setItem","stringify","deleteEv","newList","filter","Cindex","delete"],"mappings":"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","sourcesContent":["import React,{useState,useEffect} from 'react'\r\n\r\nconst Photo = ({ name, index, setState, title, state}) => {    \r\n    \r\n\r\n    const [File, setFile] = useState(null)\r\n\r\n    const clickEv = (e) => {\r\n       e.currentTarget.nextElementSibling.click()\r\n    }\r\n    useEffect(() => {\r\n        let openRequest = indexedDB.open('article-store',2)\r\n        openRequest.onupgradeneeded = () => {\r\n            let db = openRequest.result;\r\n            if (!db.objectStoreNames.contains('photoBuffer')) {\r\n                db.createObjectStore('photoBuffer', {keyPath: 'name'});\r\n              }            \r\n        }     \r\n        openRequest.onsuccess =async () => {\r\n            let db = openRequest.result;\r\n            let tx = db.transaction('photoBuffer','readwrite')\r\n            let store = tx.objectStore('photoBuffer')\r\n            let photo = store.get(name)            \r\n            photo.onsuccess = () => {                \r\n                if(photo.result) {                    \r\n                    setFile(URL.createObjectURL(photo.result.file));\r\n                }                                                                    \r\n            }            \r\n        } \r\n\r\n        return () => {\r\n            URL.revokeObjectURL(File);\r\n        }\r\n    },[])\r\n\r\n    const fileUp = (e) => {            \r\n            let file = e.target.files[0];\r\n            let src = URL.createObjectURL(file);\r\n            setFile(src)\r\n            let openRequest = indexedDB.open('article-store',2)\r\n            openRequest.onsuccess = () => {\r\n                let DB = openRequest.result;                \r\n                let transaction  =  DB.transaction('photoBuffer','readwrite');\r\n                let store = transaction.objectStore(\"photoBuffer\"); // (2)\r\n                let bufferItem = {\r\n                    name,\r\n                    file,\r\n                    create:new Date(),\r\n                }\r\n                let req = store.add(bufferItem);\r\n                req.onsuccess = () => {\r\n                    console.log('存图片buffer 成功');\r\n                    console.log(req.result);\r\n                }\r\n                req.onerror = () => {\r\n                    console.log('存图片buffer 失败');                    \r\n                    console.log(req.error);\r\n                }           \r\n            }               \r\n    }\r\n\r\n    const clearFile = (e) => {          //清楚file文件\r\n        setFile(null);\r\n        e.currentTarget.nextElementSibling.value = '';\r\n    }\r\n\r\n    const changValue = (e) => {      // 更改图片标题事件\r\n        let oldValue =    localStorage.getItem('article-content-object') ;   \r\n        if(!oldValue) return  \r\n        let mianData = JSON.parse(oldValue)                  // 根据输入的值 更新状态和localstorage！！\r\n        mianData[index].title = e.target.value;                    \r\n        localStorage.setItem('article-content-object',JSON.stringify(mianData)) ;\r\n        setState(mianData);\r\n    }\r\n\r\n    const deleteEv = (index) => {                 \r\n          let newList = state.filter( (e,Cindex) => Cindex !== index)\r\n          setState(newList);\r\n          localStorage.setItem('article-content-object',JSON.stringify(newList));\r\n\r\n          let openRequest = indexedDB.open('article-store',2)          \r\n          openRequest.onsuccess = () => {\r\n              let DB = openRequest.result;                \r\n              let transaction  =  DB.transaction('photoBuffer','readwrite');\r\n              let store = transaction.objectStore(\"photoBuffer\"); // (2)              \r\n              let req = store.delete(name);\r\n              req.onsuccess = () => {\r\n                  console.log(name + 'delete 成功');                  \r\n              }\r\n              req.onerror = () => {\r\n                  console.log(name + 'delete 失败');\r\n                  console.log(req.error);\r\n              }           \r\n          }               \r\n    }\r\n    \r\n\r\n    return (\r\n        <div className=\"row content-item position-relative\" >\r\n            <input type=\"text\" name=\"photo-title\"\r\n                  onChange={changValue} \r\n                  onInput={changValue}\r\n                  defaultValue={title? title : null} \r\n                  required\r\n                   className='px-4 text-center'/>                    \r\n            {\r\n              File ? <img src={File} alt=\"content-photo\" className='col-12 photo' onDoubleClick={clearFile}/>: <div onClick={clickEv} \r\n                                       className=' uploadRoot col-6 offset-3 d-flex justify-content-center align-items-center'> \r\n                                       <i className='iconfont icon-cloud-upload'></i>\r\n                        </div>\r\n            }            \r\n            <input type=\"file\" name={name + 'file'} id={name + 'file'} className='d-none' onChange={fileUp}/>\r\n            <div className=\"delete\" onClick={() => deleteEv(index)}>\r\n                    <i className='iconfont icon-trash-'></i>\r\n            </div> \r\n            <style jsx> {`\r\n            .content-item {\r\n                   margin-bottom:5rem;\r\n               }    \r\n               img {\r\n                   width:100%;                   \r\n               }\r\n               .photo {\r\n                    margin-bottom:3rem;\r\n               }\r\n               input[name='photo-title'] {\r\n                   height:6vh;\r\n                   width:50%;\r\n                   margin:0 auto;\r\n                   font-size:3rem;\r\n                   line-height:2;\r\n                   margin-bottom:5rem;\r\n                  \r\n               }\r\n               .uploadRoot {\r\n                   height:20vh;                   \r\n               }\r\n               i {\r\n                   font-size:8rem;\r\n                   height:8rem;\r\n                   cursor:pointer;\r\n                   transition:.2s;\r\n               }\r\n               i:hover {\r\n                font-size:9rem;\r\n                   height:9rem;\r\n               }\r\n               .delete {\r\n                   position:absolute;\r\n                   right:-50px;\r\n                   top:50%;\r\n                   \r\n               } \r\n               .delete i {\r\n                     background:none;\r\n                     color:black;  \r\n                     font-size:2rem;                   \r\n               }\r\n               .delete i:hover {\r\n                    background:black;\r\n                     color:white;                     \r\n               }\r\n                            `}\r\n            </style>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Photo\r\n"]},"metadata":{},"sourceType":"module"}