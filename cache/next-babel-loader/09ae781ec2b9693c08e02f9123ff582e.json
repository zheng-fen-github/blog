{"ast":null,"code":"var _jsxFileName = \"C:\\\\newlife\\\\newSite\\\\my-app\\\\pages\\\\release-article.js\";\nimport _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nimport React, { useEffect, useState } from \"react\";\nimport Head from \"next/head\";\nimport Nav from \"../component/release-article/nav\";\nimport Author from \"../component/release-article/author\";\nimport ArtContent from \"../component/release-article/articleContent\";\nimport About from \"../component/release-article/about\";\nimport Footer from \"../component/release-article/footer\";\nimport { useRouter } from \"next/router\";\n\nconst Home = () => {\n  let {\n    key\n  } = useRouter().query; //设置发布的钥匙串\n\n  useEffect(() => {\n    if (key) localStorage.setItem(\"article-key\", key);\n  }, []);\n\n  const uploadData = async data => {\n    try {\n      const QURL = process.env.DATA_URL + \"addArticle/add\";\n      let res = await fetch(QURL, {\n        method: \"POST\",\n        body: data\n      });\n      let result = await res.json();\n\n      if (res.ok) {\n        let keys = Object.keys(localStorage);\n\n        for (let key of keys) {\n          if (key !== \"author-name\" && key !== \"article-key\") {\n            localStorage.removeItem(key);\n          }\n        }\n\n        let openRequest = indexedDB.open(\"article-store\", 2);\n\n        openRequest.onsuccess = async () => {\n          let db = openRequest.result;\n          let tx = db.transaction(\"photoBuffer\", \"readwrite\");\n          let store = tx.objectStore(\"photoBuffer\");\n          let keys = store.getAllKeys();\n\n          keys.onsuccess = () => {\n            keys.result.map(key => {\n              if (key !== \"article-author-photo\") {\n                store.delete(key);\n                console.log(\"delete\");\n              }\n            });\n            window.location.reload();\n          };\n        };\n      } else {\n        alert(result);\n      }\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const submitForm = e => {\n    e.preventDefault();\n    let data = new FormData(e.target);\n    let content = localStorage.getItem(\"article-content-object\");\n    let fileList = JSON.parse(content).filter(item => item.type === \"photo\");\n    fileList.push({\n      key: \"article-author-photo\"\n    });\n    let openRequest = indexedDB.open(\"article-store\", 2);\n\n    openRequest.onsuccess = async () => {\n      let db = openRequest.result;\n      let tx = db.transaction(\"photoBuffer\");\n      let store = tx.objectStore(\"photoBuffer\");\n      let reqs = fileList.map(item => new Promise((resolve, reject) => {\n        let photo = store.get(item.key);\n\n        photo.onsuccess = () => {\n          if (photo.result) {\n            resolve({\n              file: photo.result.file,\n              name: item.key\n            });\n          } else {\n            reject(\"有一个图片板块没有文件。请上传或是删除点这个板块\");\n          }\n        };\n      }));\n      Promise.all(reqs).then(items => {\n        items.map(item => {\n          data.append(item.name, item.file);\n        });\n        data.append(\"article-content-main\", content);\n        data.append(\"link-count\", LinkList.length);\n        uploadData(data);\n      }).catch(alert);\n    };\n  };\n\n  const {\n    0: LinkList,\n    1: setLinkList\n  } = useState([\"a\"]);\n  return __jsx(React.Fragment, null, __jsx(Head, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 7\n    }\n  }, __jsx(\"title\", {\n    className: \"jsx-680210942\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 9\n    }\n  }, \"\\u7F16\\u5199\\u6587\\u7AE0\"), __jsx(\"link\", {\n    rel: \"stylesheet\",\n    href: \"https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css\",\n    integrity: \"sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh\",\n    crossorigin: \"anonymous\",\n    className: \"jsx-680210942\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 9\n    }\n  }), __jsx(\"link\", {\n    rel: \"stylesheet\",\n    href: \"//at.alicdn.com/t/font_1748919_7p01375xskx.css\",\n    className: \"jsx-680210942\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 9\n    }\n  }), __jsx(\"link\", {\n    rel: \"icon\",\n    href: \"/logo.jpg\",\n    type: \"image/x-icon\",\n    className: \"jsx-680210942\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 9\n    }\n  })), __jsx(\"div\", {\n    className: \"jsx-680210942\" + \" \" + \"container-fluid\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 7\n    }\n  }, __jsx(\"nav\", {\n    className: \"jsx-680210942\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 9\n    }\n  }, __jsx(Nav, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 11\n    }\n  })), __jsx(\"form\", {\n    onSubmit: submitForm,\n    className: \"jsx-680210942\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 9\n    }\n  }, __jsx(Author, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 11\n    }\n  }), __jsx(ArtContent, {\n    setLinkList: setLinkList,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 11\n    }\n  }), __jsx(About, {\n    List: LinkList,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 11\n    }\n  })), __jsx(Footer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 9\n    }\n  })), __jsx(_JSXStyle, {\n    id: \"680210942\",\n    __self: this\n  }, \"*,body{margin:0;padding:0;box-sizing:border-box;}html{font-size:10px;}.container-fluid{padding:0;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxuZXdsaWZlXFxuZXdTaXRlXFxteS1hcHBcXHBhZ2VzXFxyZWxlYXNlLWFydGljbGUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBa0l5QixBQUlvQixBQUtNLEFBR0wsU0FQQSxDQVFaLEtBSEEsSUFKd0Isc0JBQ3hCIiwiZmlsZSI6IkM6XFxuZXdsaWZlXFxuZXdTaXRlXFxteS1hcHBcXHBhZ2VzXFxyZWxlYXNlLWFydGljbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgdXNlRWZmZWN0LCB1c2VTdGF0ZSB9IGZyb20gXCJyZWFjdFwiO1xyXG5cclxuaW1wb3J0IEhlYWQgZnJvbSBcIm5leHQvaGVhZFwiO1xyXG5pbXBvcnQgTmF2IGZyb20gXCIuLi9jb21wb25lbnQvcmVsZWFzZS1hcnRpY2xlL25hdlwiO1xyXG5pbXBvcnQgQXV0aG9yIGZyb20gXCIuLi9jb21wb25lbnQvcmVsZWFzZS1hcnRpY2xlL2F1dGhvclwiO1xyXG5pbXBvcnQgQXJ0Q29udGVudCBmcm9tIFwiLi4vY29tcG9uZW50L3JlbGVhc2UtYXJ0aWNsZS9hcnRpY2xlQ29udGVudFwiO1xyXG5pbXBvcnQgQWJvdXQgZnJvbSBcIi4uL2NvbXBvbmVudC9yZWxlYXNlLWFydGljbGUvYWJvdXRcIjtcclxuaW1wb3J0IEZvb3RlciBmcm9tIFwiLi4vY29tcG9uZW50L3JlbGVhc2UtYXJ0aWNsZS9mb290ZXJcIjtcclxuaW1wb3J0IHsgdXNlUm91dGVyIH0gZnJvbSBcIm5leHQvcm91dGVyXCI7XHJcblxyXG5jb25zdCBIb21lID0gKCkgPT4ge1xyXG4gIGxldCB7IGtleSB9ID0gdXNlUm91dGVyKCkucXVlcnk7IC8v6K6+572u5Y+R5biD55qE6ZKl5YyZ5LiyXHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChrZXkpIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFwiYXJ0aWNsZS1rZXlcIiwga2V5KTtcclxuICB9LCBbXSk7XHJcbiAgY29uc3QgdXBsb2FkRGF0YSA9IGFzeW5jIChkYXRhKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBRVVJMID0gcHJvY2Vzcy5lbnYuREFUQV9VUkwgKyBcImFkZEFydGljbGUvYWRkXCI7XHJcbiAgICAgIGxldCByZXMgPSBhd2FpdCBmZXRjaChRVVJMLCB7XHJcbiAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgICAgICBib2R5OiBkYXRhLFxyXG4gICAgICB9KTtcclxuICAgICAgbGV0IHJlc3VsdCA9IGF3YWl0IHJlcy5qc29uKCk7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICBsZXQga2V5cyA9IE9iamVjdC5rZXlzKGxvY2FsU3RvcmFnZSk7XHJcbiAgICAgICAgZm9yIChsZXQga2V5IG9mIGtleXMpIHtcclxuICAgICAgICAgIGlmIChrZXkgIT09IFwiYXV0aG9yLW5hbWVcIiAmJiBrZXkgIT09IFwiYXJ0aWNsZS1rZXlcIikge1xyXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShrZXkpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgb3BlblJlcXVlc3QgPSBpbmRleGVkREIub3BlbihcImFydGljbGUtc3RvcmVcIiwgMik7XHJcbiAgICAgICAgb3BlblJlcXVlc3Qub25zdWNjZXNzID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgbGV0IGRiID0gb3BlblJlcXVlc3QucmVzdWx0O1xyXG4gICAgICAgICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oXCJwaG90b0J1ZmZlclwiLCBcInJlYWR3cml0ZVwiKTtcclxuICAgICAgICAgIGxldCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKFwicGhvdG9CdWZmZXJcIik7XHJcbiAgICAgICAgICBsZXQga2V5cyA9IHN0b3JlLmdldEFsbEtleXMoKTtcclxuICAgICAgICAgIGtleXMub25zdWNjZXNzID0gKCkgPT4ge1xyXG4gICAgICAgICAgICBrZXlzLnJlc3VsdC5tYXAoKGtleSkgPT4ge1xyXG4gICAgICAgICAgICAgIGlmIChrZXkgIT09IFwiYXJ0aWNsZS1hdXRob3ItcGhvdG9cIikge1xyXG4gICAgICAgICAgICAgICAgc3RvcmUuZGVsZXRlKGtleSk7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImRlbGV0ZVwiKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgIH07XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgYWxlcnQocmVzdWx0KTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgY29uc3Qgc3VibWl0Rm9ybSA9IChlKSA9PiB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBsZXQgZGF0YSA9IG5ldyBGb3JtRGF0YShlLnRhcmdldCk7XHJcbiAgICBsZXQgY29udGVudCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwiYXJ0aWNsZS1jb250ZW50LW9iamVjdFwiKTtcclxuXHJcbiAgICBsZXQgZmlsZUxpc3QgPSBKU09OLnBhcnNlKGNvbnRlbnQpLmZpbHRlcigoaXRlbSkgPT4gaXRlbS50eXBlID09PSBcInBob3RvXCIpO1xyXG4gICAgZmlsZUxpc3QucHVzaCh7XHJcbiAgICAgIGtleTogXCJhcnRpY2xlLWF1dGhvci1waG90b1wiLFxyXG4gICAgfSk7XHJcbiAgICBsZXQgb3BlblJlcXVlc3QgPSBpbmRleGVkREIub3BlbihcImFydGljbGUtc3RvcmVcIiwgMik7XHJcbiAgICBvcGVuUmVxdWVzdC5vbnN1Y2Nlc3MgPSBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGxldCBkYiA9IG9wZW5SZXF1ZXN0LnJlc3VsdDtcclxuICAgICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oXCJwaG90b0J1ZmZlclwiKTtcclxuICAgICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoXCJwaG90b0J1ZmZlclwiKTtcclxuICAgICAgbGV0IHJlcXMgPSBmaWxlTGlzdC5tYXAoXHJcbiAgICAgICAgKGl0ZW0pID0+XHJcbiAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBwaG90byA9IHN0b3JlLmdldChpdGVtLmtleSk7XHJcbiAgICAgICAgICAgIHBob3RvLm9uc3VjY2VzcyA9ICgpID0+IHtcclxuICAgICAgICAgICAgICBpZiAocGhvdG8ucmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKHtcclxuICAgICAgICAgICAgICAgICAgZmlsZTogcGhvdG8ucmVzdWx0LmZpbGUsXHJcbiAgICAgICAgICAgICAgICAgIG5hbWU6IGl0ZW0ua2V5LFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJlamVjdChcIuacieS4gOS4quWbvueJh+adv+Wdl+ayoeacieaWh+S7tuOAguivt+S4iuS8oOaIluaYr+WIoOmZpOeCuei/meS4quadv+Wdl1wiKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICB9KVxyXG4gICAgICApO1xyXG4gICAgICBQcm9taXNlLmFsbChyZXFzKVxyXG4gICAgICAgIC50aGVuKChpdGVtcykgPT4ge1xyXG4gICAgICAgICAgaXRlbXMubWFwKChpdGVtKSA9PiB7XHJcbiAgICAgICAgICAgIGRhdGEuYXBwZW5kKGl0ZW0ubmFtZSwgaXRlbS5maWxlKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgZGF0YS5hcHBlbmQoXCJhcnRpY2xlLWNvbnRlbnQtbWFpblwiLCBjb250ZW50KTtcclxuICAgICAgICAgIGRhdGEuYXBwZW5kKFwibGluay1jb3VudFwiLCBMaW5rTGlzdC5sZW5ndGgpO1xyXG4gICAgICAgICAgdXBsb2FkRGF0YShkYXRhKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaChhbGVydCk7XHJcbiAgICB9O1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IFtMaW5rTGlzdCwgc2V0TGlua0xpc3RdID0gdXNlU3RhdGUoW1wiYVwiXSk7XHJcblxyXG4gIHJldHVybiAoXHJcbiAgICA8PlxyXG4gICAgICA8SGVhZD5cclxuICAgICAgICA8dGl0bGU+57yW5YaZ5paH56ugPC90aXRsZT5cclxuICAgICAgICA8bGlua1xyXG4gICAgICAgICAgcmVsPVwic3R5bGVzaGVldFwiXHJcbiAgICAgICAgICBocmVmPVwiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9ib290c3RyYXBANC40LjEvZGlzdC9jc3MvYm9vdHN0cmFwLm1pbi5jc3NcIlxyXG4gICAgICAgICAgaW50ZWdyaXR5PVwic2hhMzg0LVZrb284eDRDR3NPMytIaHh2OFQvUTVQYVh0a0t0dTZ1ZzVUT2VOVjZnQmlGZVdQR0ZOOU11aE9mMjNROUlmamhcIlxyXG4gICAgICAgICAgY3Jvc3NvcmlnaW49XCJhbm9ueW1vdXNcIlxyXG4gICAgICAgID48L2xpbms+XHJcbiAgICAgICAgPGxpbmtcclxuICAgICAgICAgIHJlbD1cInN0eWxlc2hlZXRcIlxyXG4gICAgICAgICAgaHJlZj1cIi8vYXQuYWxpY2RuLmNvbS90L2ZvbnRfMTc0ODkxOV83cDAxMzc1eHNreC5jc3NcIlxyXG4gICAgICAgIC8+XHJcbiAgICAgICAgPGxpbmsgcmVsPVwiaWNvblwiIGhyZWY9XCIvbG9nby5qcGdcIiB0eXBlPVwiaW1hZ2UveC1pY29uXCI+PC9saW5rPlxyXG4gICAgICA8L0hlYWQ+XHJcbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwiY29udGFpbmVyLWZsdWlkXCI+XHJcbiAgICAgICAgPG5hdj5cclxuICAgICAgICAgIDxOYXYgLz5cclxuICAgICAgICA8L25hdj5cclxuICAgICAgICA8Zm9ybSBvblN1Ym1pdD17c3VibWl0Rm9ybX0+XHJcbiAgICAgICAgICA8QXV0aG9yIC8+XHJcblxyXG4gICAgICAgICAgPEFydENvbnRlbnQgc2V0TGlua0xpc3Q9e3NldExpbmtMaXN0fSAvPlxyXG5cclxuICAgICAgICAgIDxBYm91dCBMaXN0PXtMaW5rTGlzdH0gLz5cclxuICAgICAgICA8L2Zvcm0+XHJcblxyXG4gICAgICAgIDxGb290ZXIgLz5cclxuICAgICAgPC9kaXY+XHJcblxyXG4gICAgICA8c3R5bGUganN4IGdsb2JhbD57YFxyXG4gICAgICAgICosXHJcbiAgICAgICAgYm9keSB7XHJcbiAgICAgICAgICBtYXJnaW46IDA7XHJcbiAgICAgICAgICBwYWRkaW5nOiAwO1xyXG4gICAgICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaHRtbCB7XHJcbiAgICAgICAgICBmb250LXNpemU6IDEwcHg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC5jb250YWluZXItZmx1aWQge1xyXG4gICAgICAgICAgcGFkZGluZzogMDtcclxuICAgICAgICB9XHJcbiAgICAgIGB9PC9zdHlsZT5cclxuICAgIDwvPlxyXG4gICk7XHJcbn07XHJcblxyXG5leHBvcnQgZGVmYXVsdCBIb21lO1xyXG4iXX0= */\\n/*@ sourceURL=C:\\\\\\\\newlife\\\\\\\\newSite\\\\\\\\my-app\\\\\\\\pages\\\\\\\\release-article.js */\"));\n};\n\nexport default Home;","map":{"version":3,"sources":["C:/newlife/newSite/my-app/pages/release-article.js"],"names":["React","useEffect","useState","Head","Nav","Author","ArtContent","About","Footer","useRouter","Home","key","query","localStorage","setItem","uploadData","data","QURL","process","env","DATA_URL","res","fetch","method","body","result","json","ok","keys","Object","removeItem","openRequest","indexedDB","open","onsuccess","db","tx","transaction","store","objectStore","getAllKeys","map","delete","console","log","window","location","reload","alert","err","submitForm","e","preventDefault","FormData","target","content","getItem","fileList","JSON","parse","filter","item","type","push","reqs","Promise","resolve","reject","photo","get","file","name","all","then","items","append","LinkList","length","catch","setLinkList"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\r\n\r\nimport Head from \"next/head\";\r\nimport Nav from \"../component/release-article/nav\";\r\nimport Author from \"../component/release-article/author\";\r\nimport ArtContent from \"../component/release-article/articleContent\";\r\nimport About from \"../component/release-article/about\";\r\nimport Footer from \"../component/release-article/footer\";\r\nimport { useRouter } from \"next/router\";\r\n\r\nconst Home = () => {\r\n  let { key } = useRouter().query; //设置发布的钥匙串\r\n  useEffect(() => {\r\n    if (key) localStorage.setItem(\"article-key\", key);\r\n  }, []);\r\n  const uploadData = async (data) => {\r\n    try {\r\n      const QURL = process.env.DATA_URL + \"addArticle/add\";\r\n      let res = await fetch(QURL, {\r\n        method: \"POST\",\r\n        body: data,\r\n      });\r\n      let result = await res.json();\r\n      if (res.ok) {\r\n        let keys = Object.keys(localStorage);\r\n        for (let key of keys) {\r\n          if (key !== \"author-name\" && key !== \"article-key\") {\r\n            localStorage.removeItem(key);\r\n          }\r\n        }\r\n        let openRequest = indexedDB.open(\"article-store\", 2);\r\n        openRequest.onsuccess = async () => {\r\n          let db = openRequest.result;\r\n          let tx = db.transaction(\"photoBuffer\", \"readwrite\");\r\n          let store = tx.objectStore(\"photoBuffer\");\r\n          let keys = store.getAllKeys();\r\n          keys.onsuccess = () => {\r\n            keys.result.map((key) => {\r\n              if (key !== \"article-author-photo\") {\r\n                store.delete(key);\r\n                console.log(\"delete\");\r\n              }\r\n            });\r\n            window.location.reload();\r\n          };\r\n        };\r\n      } else {\r\n        alert(result);\r\n      }\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n\r\n  const submitForm = (e) => {\r\n    e.preventDefault();\r\n    let data = new FormData(e.target);\r\n    let content = localStorage.getItem(\"article-content-object\");\r\n\r\n    let fileList = JSON.parse(content).filter((item) => item.type === \"photo\");\r\n    fileList.push({\r\n      key: \"article-author-photo\",\r\n    });\r\n    let openRequest = indexedDB.open(\"article-store\", 2);\r\n    openRequest.onsuccess = async () => {\r\n      let db = openRequest.result;\r\n      let tx = db.transaction(\"photoBuffer\");\r\n      let store = tx.objectStore(\"photoBuffer\");\r\n      let reqs = fileList.map(\r\n        (item) =>\r\n          new Promise((resolve, reject) => {\r\n            let photo = store.get(item.key);\r\n            photo.onsuccess = () => {\r\n              if (photo.result) {\r\n                resolve({\r\n                  file: photo.result.file,\r\n                  name: item.key,\r\n                });\r\n              } else {\r\n                reject(\"有一个图片板块没有文件。请上传或是删除点这个板块\");\r\n              }\r\n            };\r\n          })\r\n      );\r\n      Promise.all(reqs)\r\n        .then((items) => {\r\n          items.map((item) => {\r\n            data.append(item.name, item.file);\r\n          });\r\n          data.append(\"article-content-main\", content);\r\n          data.append(\"link-count\", LinkList.length);\r\n          uploadData(data);\r\n        })\r\n        .catch(alert);\r\n    };\r\n  };\r\n\r\n  const [LinkList, setLinkList] = useState([\"a\"]);\r\n\r\n  return (\r\n    <>\r\n      <Head>\r\n        <title>编写文章</title>\r\n        <link\r\n          rel=\"stylesheet\"\r\n          href=\"https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css\"\r\n          integrity=\"sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh\"\r\n          crossorigin=\"anonymous\"\r\n        ></link>\r\n        <link\r\n          rel=\"stylesheet\"\r\n          href=\"//at.alicdn.com/t/font_1748919_7p01375xskx.css\"\r\n        />\r\n        <link rel=\"icon\" href=\"/logo.jpg\" type=\"image/x-icon\"></link>\r\n      </Head>\r\n      <div className=\"container-fluid\">\r\n        <nav>\r\n          <Nav />\r\n        </nav>\r\n        <form onSubmit={submitForm}>\r\n          <Author />\r\n\r\n          <ArtContent setLinkList={setLinkList} />\r\n\r\n          <About List={LinkList} />\r\n        </form>\r\n\r\n        <Footer />\r\n      </div>\r\n\r\n      <style jsx global>{`\r\n        *,\r\n        body {\r\n          margin: 0;\r\n          padding: 0;\r\n          box-sizing: border-box;\r\n        }\r\n        html {\r\n          font-size: 10px;\r\n        }\r\n        .container-fluid {\r\n          padding: 0;\r\n        }\r\n      `}</style>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Home;\r\n"]},"metadata":{},"sourceType":"module"}