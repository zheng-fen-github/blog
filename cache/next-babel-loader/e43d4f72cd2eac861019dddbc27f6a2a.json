{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nvar _this = this,\n    _jsxFileName = \"C:\\\\newlife\\\\newSite\\\\my-app\\\\component\\\\release-article\\\\authorPhoto.js\";\n\nimport _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nimport React, { useState, useEffect } from 'react';\n\nvar AuthorPhoto = function AuthorPhoto() {\n  var _useState = useState(null),\n      photo = _useState[0],\n      setPhoto = _useState[1];\n\n  var clickEv = function clickEv(e) {\n    e.target.nextElementSibling.click();\n  };\n\n  var clickEv2 = function clickEv2(e) {\n    e.target.previousElementSibling.click();\n  };\n\n  var fileChange = function fileChange(e) {\n    try {\n      var file = e.target.files[0];\n      var img = document.createElement('img');\n      img.src = URL.createObjectURL(file);\n\n      img.onload = function () {\n        document.querySelector('.photo-container').append(img);\n        canvasFunc(img.offsetWidth, img.offsetHeight, img, setPhoto);\n      };\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  useEffect(function () {\n    var openRequest = indexedDB.open('article-store', 2);\n\n    openRequest.onupgradeneeded = function () {\n      var db = openRequest.result;\n\n      if (!db.objectStoreNames.contains('photoBuffer')) {\n        db.createObjectStore('photoBuffer', {\n          keyPath: 'name'\n        });\n      }\n    };\n\n    openRequest.onsuccess = function _callee() {\n      var db, tx, store, photo;\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              db = openRequest.result;\n              tx = db.transaction('photoBuffer');\n              store = tx.objectStore('photoBuffer');\n              photo = store.get('article-author-photo');\n\n              photo.onsuccess = function () {\n                if (photo.result) {\n                  setPhoto(photo.result.file);\n                }\n              };\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    };\n\n    return function () {\n      URL.revokeObjectURL(photo);\n    };\n  }, []);\n  return __jsx(React.Fragment, null, !photo && __jsx(\"div\", {\n    onClick: clickEv,\n    className: \"jsx-2605298663\" + \" \" + \"file-upload-button\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 55,\n      columnNumber: 25\n    }\n  }), __jsx(\"input\", {\n    type: \"file\",\n    name: \"author-photo-file\",\n    onChange: fileChange,\n    className: \"jsx-2605298663\" + \" \" + 'd-none',\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 59,\n      columnNumber: 12\n    }\n  }), photo && __jsx(\"img\", {\n    src: URL.createObjectURL(photo),\n    alt: \"author-photo\",\n    onClick: clickEv2,\n    className: \"jsx-2605298663\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 61,\n      columnNumber: 25\n    }\n  }), __jsx(\"div\", {\n    style: {\n      position: 'fixed',\n      left: 0,\n      top: 0,\n      visibility: 'hidden',\n      userSelect: 'none'\n    },\n    className: \"jsx-2605298663\" + \" \" + \"photo-container\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 12\n    }\n  }), __jsx(\"canvas\", {\n    id: \"canvas\",\n    hidden: true,\n    className: \"jsx-2605298663\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 12\n    }\n  }), __jsx(\"canvas\", {\n    id: \"canvas2\",\n    hidden: true,\n    className: \"jsx-2605298663\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 12\n    }\n  }), __jsx(_JSXStyle, {\n    id: \"2605298663\",\n    __self: _this\n  }, \".file-upload-button.jsx-2605298663{width:80px;height:80px;background:black;cursor:pointer;}img.jsx-2605298663{cursor:pointer;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxuZXdsaWZlXFxuZXdTaXRlXFxteS1hcHBcXGNvbXBvbmVudFxccmVsZWFzZS1hcnRpY2xlXFxhdXRob3JQaG90by5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUEwRXVCLEFBR2lDLEFBTUksV0FMSCxJQU1mLFFBTG9CLGlCQUNGLGVBQ2xCIiwiZmlsZSI6IkM6XFxuZXdsaWZlXFxuZXdTaXRlXFxteS1hcHBcXGNvbXBvbmVudFxccmVsZWFzZS1hcnRpY2xlXFxhdXRob3JQaG90by5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCAseyB1c2VTdGF0ZSAsIHVzZUVmZmVjdH0gZnJvbSAncmVhY3QnXHJcblxyXG5jb25zdCBBdXRob3JQaG90byA9ICgpID0+IHtcclxuICAgIGNvbnN0IFtwaG90bywgc2V0UGhvdG9dID0gdXNlU3RhdGUobnVsbClcclxuICAgXHJcbiAgICBjb25zdCBjbGlja0V2ID0gKGUpID0+IHtcclxuICAgICAgICBlLnRhcmdldC5uZXh0RWxlbWVudFNpYmxpbmcuY2xpY2soKVxyXG4gICAgfVxyXG4gICAgY29uc3QgY2xpY2tFdjIgPSAoZSkgPT4ge1xyXG4gICAgICAgIGUudGFyZ2V0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcuY2xpY2soKVxyXG4gICAgfVxyXG4gICAgY29uc3QgZmlsZUNoYW5nZSA9IChlKSA9PiB7ICAgICAgICAgXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgbGV0IGZpbGUgPSBlLnRhcmdldC5maWxlc1swXTsgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgbGV0IGltZyAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcclxuICAgICAgICAgICAgaW1nLnNyYyA9IFVSTC5jcmVhdGVPYmplY3RVUkwoZmlsZSk7XHJcbiAgICAgICAgICAgIGltZy5vbmxvYWQgPSAoKSA9PiB7ICAgICAgXHJcbiAgICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBob3RvLWNvbnRhaW5lcicpLmFwcGVuZChpbWcpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICBjYW52YXNGdW5jKGltZy5vZmZzZXRXaWR0aCxpbWcub2Zmc2V0SGVpZ2h0LGltZyxzZXRQaG90byk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9Y2F0Y2goZXJyKSB7XHJcbiAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpXHJcbiAgICAgICAgfSAgICAgICAgICAgICAgICAgIFxyXG4gICB9XHJcbiAgIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBsZXQgb3BlblJlcXVlc3QgPSBpbmRleGVkREIub3BlbignYXJ0aWNsZS1zdG9yZScsMilcclxuICAgIG9wZW5SZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9ICgpID0+IHtcclxuICAgICAgICBsZXQgZGIgPSBvcGVuUmVxdWVzdC5yZXN1bHQ7XHJcbiAgICAgICAgaWYgKCFkYi5vYmplY3RTdG9yZU5hbWVzLmNvbnRhaW5zKCdwaG90b0J1ZmZlcicpKSB7XHJcbiAgICAgICAgICAgIGRiLmNyZWF0ZU9iamVjdFN0b3JlKCdwaG90b0J1ZmZlcicsIHtrZXlQYXRoOiAnbmFtZSd9KTtcclxuICAgICAgICAgIH0gICAgICAgICAgICBcclxuICAgIH0gICAgIFxyXG4gICAgb3BlblJlcXVlc3Qub25zdWNjZXNzID1hc3luYyAoKSA9PiB7XHJcbiAgICAgICAgbGV0IGRiID0gb3BlblJlcXVlc3QucmVzdWx0O1xyXG4gICAgICAgIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdwaG90b0J1ZmZlcicpXHJcbiAgICAgICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Bob3RvQnVmZmVyJylcclxuICAgICAgICBsZXQgcGhvdG8gPSBzdG9yZS5nZXQoJ2FydGljbGUtYXV0aG9yLXBob3RvJylcclxuICAgICAgICBwaG90by5vbnN1Y2Nlc3MgPSAoKSA9PiB7ICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmKHBob3RvLnJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgc2V0UGhvdG8ocGhvdG8ucmVzdWx0LmZpbGUpO1xyXG4gICAgICAgICAgICB9ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgIH0gXHJcbiAgICByZXR1cm4gKCkgPT4ge1xyXG4gICAgICAgIFVSTC5yZXZva2VPYmplY3RVUkwocGhvdG8pO1xyXG4gICAgfVxyXG59LFtdKVxyXG4gIFxyXG5cclxuICAgIHJldHVybiAoXHJcbiAgICAgICAgPD5cclxuICAgICAgICAgICBcclxuICAgICAgICAgIHsgXHJcbiAgICAgICAgICAgICAhcGhvdG8gJiYgIDxkaXYgY2xhc3NOYW1lPVwiZmlsZS11cGxvYWQtYnV0dG9uXCIgb25DbGljaz17Y2xpY2tFdn0+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICB9XHJcbiAgICAgICAgICAgPGlucHV0IHR5cGU9XCJmaWxlXCIgbmFtZT1cImF1dGhvci1waG90by1maWxlXCIgY2xhc3NOYW1lPSdkLW5vbmUnIG9uQ2hhbmdlPXtmaWxlQ2hhbmdlfS8+XHJcbiAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICBwaG90byAmJiA8aW1nIHNyYz17VVJMLmNyZWF0ZU9iamVjdFVSTChwaG90byl9IGFsdD1cImF1dGhvci1waG90b1wiIG9uQ2xpY2s9e2NsaWNrRXYyfS8+XHJcbiAgICAgICAgICAgfVxyXG4gICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwicGhvdG8tY29udGFpbmVyXCIgc3R5bGU9e3twb3NpdGlvbjonZml4ZWQnLFxyXG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6MCx0b3A6MCxcclxuICAgICAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OidoaWRkZW4nLFxyXG4gICAgICAgICAgICAgICAgICAgIHVzZXJTZWxlY3Q6J25vbmUnICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9fT48L2Rpdj5cclxuICAgICAgICAgICA8Y2FudmFzIGlkPVwiY2FudmFzXCIgaGlkZGVuPlxyXG4gICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICA8L2NhbnZhcz5cclxuICAgICAgICAgICA8Y2FudmFzIGlkPVwiY2FudmFzMlwiIGhpZGRlbiA+XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgIDwvY2FudmFzPlxyXG5cclxuICAgICAgICAgICA8c3R5bGUganN4PntgXHJcbiAgICAgICAgICAgICAgICAgIC5maWxlLXVwbG9hZC1idXR0b24ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgd2lkdGg6ODBweDtcclxuICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDo4MHB4O1xyXG4gICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZDpibGFjaztcclxuICAgICAgICAgICAgICAgICAgICAgIGN1cnNvcjpwb2ludGVyO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgIGltZyB7XHJcbiAgICAgICAgICAgICAgICAgICAgICBjdXJzb3I6cG9pbnRlcjtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICBgfTwvc3R5bGU+XHJcbiAgICAgICAgPC8+XHJcbiAgICApXHJcbn1cclxuXHJcblxyXG5cclxuY29uc3QgY2FudmFzRnVuYyA9IChXLEgsaW1nLGxvYWRQaG90bykgPT4ge1xyXG4gICAgbGV0IGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW52YXMnKTtcclxuICAgIGxldCAgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XHJcbiAgICBsZXQgY291bnQgPSBNYXRoLm1pbihXLEgpO1xyXG4gICAgY2FudmFzLndpZHRoID0gY291bnQ7XHJcbiAgICBjYW52YXMuaGVpZ2h0ID0gY291bnQ7XHJcbiAgICBsZXQgdyA9KE1hdGgubWF4KFcsSCktY291bnQpLzI7ICAgIFxyXG4gICAgVz5IP2N0eC5kcmF3SW1hZ2UoaW1nLC13LDApOiBjdHguZHJhd0ltYWdlKGltZywwLC13KTsgLy/oo4Hlh4/miJDkuIDmr5TkuIAgICAgXHJcbiAgICBsZXQgY3R4MiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW52YXMyJykuZ2V0Q29udGV4dCgnMmQnKTtcclxuICAgIGNhbnZhczIud2lkdGggPSA4MDtcclxuICAgIGNhbnZhczIuaGVpZ2h0PSA4MDtcclxuICAgIGN0eDIuZHJhd0ltYWdlKGNhbnZhcywwLDAsODAsODApOyAgLy8g57yp5pS+5oiQNDBweCA0MHB4XHJcblxyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbnZhczInKS50b0Jsb2IoKGJsb2IpID0+IHsgIC8vIOi+k+WHuuWbvueJh1xyXG4gICAgICAgXHJcbiAgICAgICBsZXQgbmFtZSA9ICdhdXRob3JQaG90by4nICsgYmxvYi50eXBlLnNsaWNlKDYsOSk7ICAgICAgIFxyXG4gICAgICAgbGV0IGZpbGUgPSBuZXcgRmlsZShbYmxvYl0sbmFtZSk7XHJcbiAgICAgICBcclxuICAgICAgIGxvYWRQaG90byhibG9iKVxyXG4gICAgICAgbGV0IG9wZW5SZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oJ2FydGljbGUtc3RvcmUnLDIpXHJcbiAgICAgICBvcGVuUmVxdWVzdC5vbnN1Y2Nlc3MgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgbGV0IERCID0gb3BlblJlcXVlc3QucmVzdWx0OyAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICBsZXQgdHJhbnNhY3Rpb24gID0gIERCLnRyYW5zYWN0aW9uKCdwaG90b0J1ZmZlcicsJ3JlYWR3cml0ZScpO1xyXG4gICAgICAgICAgIGxldCBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKFwicGhvdG9CdWZmZXJcIik7IFxyXG4gICAgICAgICAgIGxldCBwaG90byA9IHN0b3JlLmdldCgnYXJ0aWNsZS1hdXRob3ItcGhvdG8nKVxyXG4gICAgICAgICAgIHBob3RvLm9uc3VjY2VzcyA9ICgpID0+IHsgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZihwaG90by5yZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBzdG9yZS5kZWxldGUoJ2FydGljbGUtYXV0aG9yLXBob3RvJykgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGxldCBidWZmZXJJdGVtID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6J2FydGljbGUtYXV0aG9yLXBob3RvJyxcclxuICAgICAgICAgICAgICAgICAgICBmaWxlLFxyXG4gICAgICAgICAgICAgICAgICAgIGNyZWF0ZTpuZXcgRGF0ZSgpLFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgbGV0IHJlcSA9IHN0b3JlLmFkZChidWZmZXJJdGVtKTsgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICByZXEub25lcnJvciA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn5a2Y5Zu+54mHYnVmZmVyIOWksei0pScpOyAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVxLmVycm9yKTtcclxuICAgICAgICAgICAgICAgIH0gICAgICAgICAgIFxyXG4gICAgICAgICAgICB9ICAgICAgICAgICAgXHJcbiAgICAgICB9ICAgXHJcbiAgICAvLyAgICBsZXQgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsgICAgICAgXHJcbiAgICAvLyAgICBhLmhyZWYgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpOyAgXHJcbiAgICAvLyAgICBhLmRvd25sb2FkID0gdHJ1ZTsgICBcclxuICAgIC8vICAgIGEuY2xpY2soKTsgICAgIFxyXG59LCdpbWFnZS9wbmcnKVxyXG5cclxufVxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuZXhwb3J0IGRlZmF1bHQgQXV0aG9yUGhvdG9cclxuIl19 */\\n/*@ sourceURL=C:\\\\\\\\newlife\\\\\\\\newSite\\\\\\\\my-app\\\\\\\\component\\\\\\\\release-article\\\\\\\\authorPhoto.js */\"));\n};\n\nvar canvasFunc = function canvasFunc(W, H, img, loadPhoto) {\n  var canvas = document.getElementById('canvas');\n  var ctx = canvas.getContext('2d');\n  var count = Math.min(W, H);\n  canvas.width = count;\n  canvas.height = count;\n  var w = (Math.max(W, H) - count) / 2;\n  W > H ? ctx.drawImage(img, -w, 0) : ctx.drawImage(img, 0, -w); //裁减成一比一    \n\n  var ctx2 = document.getElementById('canvas2').getContext('2d');\n  canvas2.width = 80;\n  canvas2.height = 80;\n  ctx2.drawImage(canvas, 0, 0, 80, 80); // 缩放成40px 40px\n\n  document.getElementById('canvas2').toBlob(function (blob) {\n    // 输出图片\n    var name = 'authorPhoto.' + blob.type.slice(6, 9);\n    var file = new File([blob], name);\n    loadPhoto(blob);\n    var openRequest = indexedDB.open('article-store', 2);\n\n    openRequest.onsuccess = function () {\n      var DB = openRequest.result;\n      var transaction = DB.transaction('photoBuffer', 'readwrite');\n      var store = transaction.objectStore(\"photoBuffer\");\n      var photo = store.get('article-author-photo');\n\n      photo.onsuccess = function () {\n        if (photo.result) {\n          store[\"delete\"]('article-author-photo');\n        }\n\n        var bufferItem = {\n          name: 'article-author-photo',\n          file: file,\n          create: new Date()\n        };\n        var req = store.add(bufferItem);\n\n        req.onerror = function () {\n          console.log('存图片buffer 失败');\n          console.log(req.error);\n        };\n      };\n    }; //    let a = document.createElement('a');       \n    //    a.href = URL.createObjectURL(blob);  \n    //    a.download = true;   \n    //    a.click();     \n\n  }, 'image/png');\n};\n\nexport default AuthorPhoto;","map":{"version":3,"sources":["C:/newlife/newSite/my-app/component/release-article/authorPhoto.js"],"names":["React","useState","useEffect","AuthorPhoto","photo","setPhoto","clickEv","e","target","nextElementSibling","click","clickEv2","previousElementSibling","fileChange","file","files","img","document","createElement","src","URL","createObjectURL","onload","querySelector","append","canvasFunc","offsetWidth","offsetHeight","err","console","log","openRequest","indexedDB","open","onupgradeneeded","db","result","objectStoreNames","contains","createObjectStore","keyPath","onsuccess","tx","transaction","store","objectStore","get","revokeObjectURL","position","left","top","visibility","userSelect","W","H","loadPhoto","canvas","getElementById","ctx","getContext","count","Math","min","width","height","w","max","drawImage","ctx2","canvas2","toBlob","blob","name","type","slice","File","DB","bufferItem","create","Date","req","add","onerror","error"],"mappings":"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","sourcesContent":["import React ,{ useState , useEffect} from 'react'\r\n\r\nconst AuthorPhoto = () => {\r\n    const [photo, setPhoto] = useState(null)\r\n   \r\n    const clickEv = (e) => {\r\n        e.target.nextElementSibling.click()\r\n    }\r\n    const clickEv2 = (e) => {\r\n        e.target.previousElementSibling.click()\r\n    }\r\n    const fileChange = (e) => {         \r\n        try {\r\n            let file = e.target.files[0];                     \r\n            let img  = document.createElement('img');\r\n            img.src = URL.createObjectURL(file);\r\n            img.onload = () => {      \r\n                 document.querySelector('.photo-container').append(img);                                                 \r\n                 canvasFunc(img.offsetWidth,img.offsetHeight,img,setPhoto);\r\n            }\r\n        }catch(err) {\r\n             console.log(err)\r\n        }                  \r\n   }\r\n   useEffect(() => {\r\n    let openRequest = indexedDB.open('article-store',2)\r\n    openRequest.onupgradeneeded = () => {\r\n        let db = openRequest.result;\r\n        if (!db.objectStoreNames.contains('photoBuffer')) {\r\n            db.createObjectStore('photoBuffer', {keyPath: 'name'});\r\n          }            \r\n    }     \r\n    openRequest.onsuccess =async () => {\r\n        let db = openRequest.result;\r\n        let tx = db.transaction('photoBuffer')\r\n        let store = tx.objectStore('photoBuffer')\r\n        let photo = store.get('article-author-photo')\r\n        photo.onsuccess = () => {            \r\n            if(photo.result) {\r\n                setPhoto(photo.result.file);\r\n            }                                                    \r\n        }\r\n        \r\n    } \r\n    return () => {\r\n        URL.revokeObjectURL(photo);\r\n    }\r\n},[])\r\n  \r\n\r\n    return (\r\n        <>\r\n           \r\n          { \r\n             !photo &&  <div className=\"file-upload-button\" onClick={clickEv}>\r\n                            \r\n              </div>\r\n           }\r\n           <input type=\"file\" name=\"author-photo-file\" className='d-none' onChange={fileChange}/>\r\n           {\r\n               photo && <img src={URL.createObjectURL(photo)} alt=\"author-photo\" onClick={clickEv2}/>\r\n           }\r\n           <div className=\"photo-container\" style={{position:'fixed',\r\n                    left:0,top:0,\r\n                    visibility:'hidden',\r\n                    userSelect:'none'                \r\n            }}></div>\r\n           <canvas id=\"canvas\" hidden>\r\n                     \r\n           </canvas>\r\n           <canvas id=\"canvas2\" hidden >\r\n            \r\n           </canvas>\r\n\r\n           <style jsx>{`\r\n                  .file-upload-button {\r\n                      width:80px;\r\n                      height:80px;\r\n                      background:black;\r\n                      cursor:pointer;\r\n                  }\r\n                  img {\r\n                      cursor:pointer;\r\n                  }\r\n               `}</style>\r\n        </>\r\n    )\r\n}\r\n\r\n\r\n\r\nconst canvasFunc = (W,H,img,loadPhoto) => {\r\n    let canvas = document.getElementById('canvas');\r\n    let  ctx = canvas.getContext('2d');\r\n    let count = Math.min(W,H);\r\n    canvas.width = count;\r\n    canvas.height = count;\r\n    let w =(Math.max(W,H)-count)/2;    \r\n    W>H?ctx.drawImage(img,-w,0): ctx.drawImage(img,0,-w); //裁减成一比一    \r\n    let ctx2 = document.getElementById('canvas2').getContext('2d');\r\n    canvas2.width = 80;\r\n    canvas2.height= 80;\r\n    ctx2.drawImage(canvas,0,0,80,80);  // 缩放成40px 40px\r\n\r\n    document.getElementById('canvas2').toBlob((blob) => {  // 输出图片\r\n       \r\n       let name = 'authorPhoto.' + blob.type.slice(6,9);       \r\n       let file = new File([blob],name);\r\n       \r\n       loadPhoto(blob)\r\n       let openRequest = indexedDB.open('article-store',2)\r\n       openRequest.onsuccess = () => {\r\n           let DB = openRequest.result;                \r\n           let transaction  =  DB.transaction('photoBuffer','readwrite');\r\n           let store = transaction.objectStore(\"photoBuffer\"); \r\n           let photo = store.get('article-author-photo')\r\n           photo.onsuccess = () => {                         \r\n                if(photo.result) {\r\n                    store.delete('article-author-photo')                    \r\n                }                                                    \r\n                let bufferItem = {\r\n                    name:'article-author-photo',\r\n                    file,\r\n                    create:new Date(),\r\n                }\r\n                let req = store.add(bufferItem);                \r\n                req.onerror = () => {\r\n                    console.log('存图片buffer 失败');                    \r\n                    console.log(req.error);\r\n                }           \r\n            }            \r\n       }   \r\n    //    let a = document.createElement('a');       \r\n    //    a.href = URL.createObjectURL(blob);  \r\n    //    a.download = true;   \r\n    //    a.click();     \r\n},'image/png')\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nexport default AuthorPhoto\r\n"]},"metadata":{},"sourceType":"module"}