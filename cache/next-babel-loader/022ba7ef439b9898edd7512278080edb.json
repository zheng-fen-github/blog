{"ast":null,"code":"import _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nimport React, { useState, useEffect } from 'react';\n\nconst Photo = ({\n  name,\n  index,\n  setState,\n  title,\n  state\n}) => {\n  const {\n    0: File,\n    1: setFile\n  } = useState(null);\n\n  const clickEv = e => {\n    e.currentTarget.nextElementSibling.click();\n  };\n\n  useEffect(() => {\n    let openRequest = indexedDB.open('article-store', 2);\n\n    openRequest.onupgradeneeded = () => {\n      let db = openRequest.result;\n\n      if (!db.objectStoreNames.contains('photoBuffer')) {\n        db.createObjectStore('photoBuffer', {\n          keyPath: 'name'\n        });\n      }\n    };\n\n    openRequest.onsuccess = async () => {\n      let db = openRequest.result;\n      let tx = db.transaction('photoBuffer', 'readwrite');\n      let store = tx.objectStore('photoBuffer');\n      let photo = store.get(name);\n\n      photo.onsuccess = () => {\n        if (photo.result) {\n          setFile(URL.createObjectURL(photo.result.file));\n        }\n      };\n    };\n\n    return () => {\n      URL.revokeObjectURL(File);\n    };\n  }, []);\n\n  const fileUp = e => {\n    let file = e.target.files[0];\n    let src = URL.createObjectURL(file);\n    setFile(src);\n    let openRequest = indexedDB.open('article-store', 2);\n\n    openRequest.onsuccess = () => {\n      let DB = openRequest.result;\n      let transaction = DB.transaction('photoBuffer', 'readwrite');\n      let store = transaction.objectStore(\"photoBuffer\"); // (2)\n\n      let bufferItem = {\n        name,\n        file,\n        create: new Date()\n      };\n      let req = store.add(bufferItem);\n\n      req.onsuccess = () => {\n        console.log('存图片buffer 成功');\n        console.log(req.result);\n      };\n\n      req.onerror = () => {\n        console.log('存图片buffer 失败');\n        console.log(req.error);\n      };\n    };\n  };\n\n  const clearFile = e => {\n    //清楚file文件\n    setFile(null);\n    e.currentTarget.nextElementSibling.value = '';\n  };\n\n  const changValue = e => {\n    // 更改图片标题事件\n    let oldValue = localStorage.getItem('article-content-object');\n    if (!oldValue) return;\n    let mianData = JSON.parse(oldValue); // 根据输入的值 更新状态和localstorage！！\n\n    mianData[index].title = e.target.value;\n    localStorage.setItem('article-content-object', JSON.stringify(mianData));\n    setState(mianData);\n  };\n\n  const deleteEv = index => {\n    let newList = state.filter((e, Cindex) => Cindex !== index);\n    setState(newList);\n    localStorage.setItem('article-content-object', JSON.stringify(newList));\n    let openRequest = indexedDB.open('article-store', 2);\n\n    openRequest.onsuccess = () => {\n      let DB = openRequest.result;\n      let transaction = DB.transaction('photoBuffer', 'readwrite');\n      let store = transaction.objectStore(\"photoBuffer\"); // (2)              \n\n      let req = store.delete(name);\n\n      req.onsuccess = () => {\n        console.log(name + 'delete 成功');\n      };\n\n      req.onerror = () => {\n        console.log(name + 'delete 失败');\n        console.log(req.error);\n      };\n    };\n  };\n\n  return __jsx(\"div\", {\n    className: \"jsx-2814629420\" + \" \" + \"row content-item position-relative\"\n  }, __jsx(\"input\", {\n    type: \"text\",\n    name: \"photo-title\",\n    onChange: changValue,\n    onInput: changValue,\n    defaultValue: title ? title : null,\n    required: true,\n    className: \"jsx-2814629420\" + \" \" + 'px-4 text-center'\n  }), File ? __jsx(\"img\", {\n    src: File,\n    alt: \"content-photo\",\n    onDoubleClick: clearFile,\n    className: \"jsx-2814629420\" + \" \" + 'col-12 photo'\n  }) : __jsx(\"div\", {\n    onClick: clickEv,\n    className: \"jsx-2814629420\" + \" \" + ' uploadRoot col-6 offset-3 d-flex justify-content-center align-items-center'\n  }, __jsx(\"i\", {\n    className: \"jsx-2814629420\" + \" \" + 'iconfont icon-cloud-upload'\n  })), __jsx(\"input\", {\n    type: \"file\",\n    name: name + 'file',\n    id: name + 'file',\n    onChange: fileUp,\n    className: \"jsx-2814629420\" + \" \" + 'd-none'\n  }), __jsx(\"div\", {\n    onClick: () => deleteEv(index),\n    className: \"jsx-2814629420\" + \" \" + \"delete\"\n  }, __jsx(\"i\", {\n    className: \"jsx-2814629420\" + \" \" + 'iconfont icon-trash-'\n  })), __jsx(_JSXStyle, {\n    id: \"2814629420\"\n  }, [\".content-item.jsx-2814629420{margin-bottom:5rem;}\", \"img.jsx-2814629420{width:100%;}\", \".photo.jsx-2814629420{margin-bottom:3rem;}\", \"input[name='photo-title'].jsx-2814629420{height:6vh;width:50%;margin:0 auto;font-size:3rem;line-height:2;margin-bottom:5rem;}\", \".uploadRoot.jsx-2814629420{height:20vh;}\", \"i.jsx-2814629420{font-size:8rem;height:8rem;cursor:pointer;-webkit-transition:.2s;transition:.2s;}\", \"i.jsx-2814629420:hover{font-size:9rem;height:9rem;}\", \".delete.jsx-2814629420{position:absolute;right:-50px;top:50%;}\", \".delete.jsx-2814629420 i.jsx-2814629420{background:none;color:black;font-size:2rem;}\", \".delete.jsx-2814629420 i.jsx-2814629420:hover{background:black;color:white;}\"]));\n};\n\nexport default Photo;","map":null,"metadata":{},"sourceType":"module"}