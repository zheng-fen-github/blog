{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nvar _this = this,\n    _jsxFileName = \"C:\\\\newlife\\\\newSite\\\\my-app\\\\pages\\\\release-article.js\";\n\nimport _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nimport React, { useEffect, useState } from \"react\";\nimport Head from \"next/head\";\nimport Nav from \"../component/release-article/nav\";\nimport Author from \"../component/release-article/author\";\nimport ArtContent from \"../component/release-article/articleContent\";\nimport About from \"../component/release-article/about\";\nimport Footer from \"../component/release-article/footer\";\nimport { useRouter } from \"next/router\";\n\nvar Home = function Home() {\n  var uploadData = function uploadData(data) {\n    var QURL, res, result, keys, _i, _keys, key, openRequest;\n\n    return _regeneratorRuntime.async(function uploadData$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.prev = 0;\n            QURL = process.env.DATA_URL + \"addArticle/add\";\n            _context2.next = 4;\n            return _regeneratorRuntime.awrap(fetch(QURL, {\n              method: \"POST\",\n              body: data\n            }));\n\n          case 4:\n            res = _context2.sent;\n            _context2.next = 7;\n            return _regeneratorRuntime.awrap(res.json());\n\n          case 7:\n            result = _context2.sent;\n\n            if (res.ok) {\n              keys = Object.keys(localStorage);\n\n              for (_i = 0, _keys = keys; _i < _keys.length; _i++) {\n                key = _keys[_i];\n\n                if (key !== \"author-name\" && key !== \"article-key\") {\n                  localStorage.removeItem(key);\n                }\n              }\n\n              openRequest = indexedDB.open(\"article-store\", 2);\n\n              openRequest.onsuccess = function _callee() {\n                var db, tx, store, keys;\n                return _regeneratorRuntime.async(function _callee$(_context) {\n                  while (1) {\n                    switch (_context.prev = _context.next) {\n                      case 0:\n                        db = openRequest.result;\n                        tx = db.transaction(\"photoBuffer\", \"readwrite\");\n                        store = tx.objectStore(\"photoBuffer\");\n                        keys = store.getAllKeys();\n\n                        keys.onsuccess = function () {\n                          keys.result.map(function (key) {\n                            if (key !== \"article-author-photo\") {\n                              store[\"delete\"](key);\n                              console.log(\"delete\");\n                            }\n                          });\n                          window.location.reload();\n                        };\n\n                      case 5:\n                      case \"end\":\n                        return _context.stop();\n                    }\n                  }\n                }, null, null, null, Promise);\n              };\n            } else {\n              alert(result);\n            }\n\n            _context2.next = 14;\n            break;\n\n          case 11:\n            _context2.prev = 11;\n            _context2.t0 = _context2[\"catch\"](0);\n            console.log(_context2.t0);\n\n          case 14:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[0, 11]], Promise);\n  };\n\n  var submitForm = function submitForm(e) {\n    e.preventDefault();\n    var data = new FormData(e.target);\n    var content = localStorage.getItem(\"article-content-object\");\n    var fileList = JSON.parse(content).filter(function (item) {\n      return item.type === \"photo\";\n    });\n    fileList.push({\n      key: \"article-author-photo\"\n    });\n    var openRequest = indexedDB.open(\"article-store\", 2);\n\n    openRequest.onsuccess = function _callee2() {\n      var db, tx, store, reqs;\n      return _regeneratorRuntime.async(function _callee2$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              db = openRequest.result;\n              tx = db.transaction(\"photoBuffer\");\n              store = tx.objectStore(\"photoBuffer\");\n              reqs = fileList.map(function (item) {\n                return new Promise(function (resolve, reject) {\n                  var photo = store.get(item.key);\n\n                  photo.onsuccess = function () {\n                    if (photo.result) {\n                      resolve({\n                        file: photo.result.file,\n                        name: item.key\n                      });\n                    } else {\n                      reject(\"有一个图片板块没有文件。请上传或是删除点这个板块\");\n                    }\n                  };\n                });\n              });\n              Promise.all(reqs).then(function (items) {\n                items.map(function (item) {\n                  data.append(item.name, item.file);\n                });\n                data.append(\"article-content-main\", content);\n                data.append(\"link-count\", LinkList.length);\n                uploadData(data);\n              })[\"catch\"](alert);\n\n            case 5:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    };\n  };\n\n  var _useState = useState([\"a\"]),\n      LinkList = _useState[0],\n      setLinkList = _useState[1];\n\n  return __jsx(React.Fragment, null, __jsx(Head, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 7\n    }\n  }, __jsx(\"title\", {\n    className: \"jsx-680210942\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 9\n    }\n  }, \"\\u7F16\\u5199\\u6587\\u7AE0\"), __jsx(\"link\", {\n    rel: \"stylesheet\",\n    href: \"https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css\",\n    integrity: \"sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh\",\n    crossorigin: \"anonymous\",\n    className: \"jsx-680210942\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 9\n    }\n  }), __jsx(\"link\", {\n    rel: \"stylesheet\",\n    href: \"//at.alicdn.com/t/font_1748919_7p01375xskx.css\",\n    className: \"jsx-680210942\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 9\n    }\n  }), __jsx(\"link\", {\n    rel: \"icon\",\n    href: \"/logo.jpg\",\n    type: \"image/x-icon\",\n    className: \"jsx-680210942\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 9\n    }\n  })), __jsx(\"div\", {\n    className: \"jsx-680210942\" + \" \" + \"container-fluid\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 7\n    }\n  }, __jsx(\"nav\", {\n    className: \"jsx-680210942\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 9\n    }\n  }, __jsx(Nav, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 11\n    }\n  })), __jsx(\"form\", {\n    onSubmit: submitForm,\n    className: \"jsx-680210942\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 9\n    }\n  }, __jsx(Author, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 11\n    }\n  }), __jsx(ArtContent, {\n    setLinkList: setLinkList,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 11\n    }\n  }), __jsx(About, {\n    List: LinkList,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 11\n    }\n  })), __jsx(Footer, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 9\n    }\n  })), __jsx(_JSXStyle, {\n    id: \"680210942\",\n    __self: _this\n  }, \"*,body{margin:0;padding:0;box-sizing:border-box;}html{font-size:10px;}.container-fluid{padding:0;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxuZXdsaWZlXFxuZXdTaXRlXFxteS1hcHBcXHBhZ2VzXFxyZWxlYXNlLWFydGljbGUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBOEh5QixBQUlvQixBQUtNLEFBR0wsU0FQQSxDQVFaLEtBSEEsSUFKd0Isc0JBQ3hCIiwiZmlsZSI6IkM6XFxuZXdsaWZlXFxuZXdTaXRlXFxteS1hcHBcXHBhZ2VzXFxyZWxlYXNlLWFydGljbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgdXNlRWZmZWN0LCB1c2VTdGF0ZSB9IGZyb20gXCJyZWFjdFwiO1xyXG5cclxuaW1wb3J0IEhlYWQgZnJvbSBcIm5leHQvaGVhZFwiO1xyXG5pbXBvcnQgTmF2IGZyb20gXCIuLi9jb21wb25lbnQvcmVsZWFzZS1hcnRpY2xlL25hdlwiO1xyXG5pbXBvcnQgQXV0aG9yIGZyb20gXCIuLi9jb21wb25lbnQvcmVsZWFzZS1hcnRpY2xlL2F1dGhvclwiO1xyXG5pbXBvcnQgQXJ0Q29udGVudCBmcm9tIFwiLi4vY29tcG9uZW50L3JlbGVhc2UtYXJ0aWNsZS9hcnRpY2xlQ29udGVudFwiO1xyXG5pbXBvcnQgQWJvdXQgZnJvbSBcIi4uL2NvbXBvbmVudC9yZWxlYXNlLWFydGljbGUvYWJvdXRcIjtcclxuaW1wb3J0IEZvb3RlciBmcm9tIFwiLi4vY29tcG9uZW50L3JlbGVhc2UtYXJ0aWNsZS9mb290ZXJcIjtcclxuaW1wb3J0IHsgdXNlUm91dGVyIH0gZnJvbSBcIm5leHQvcm91dGVyXCI7XHJcblxyXG5jb25zdCBIb21lID0gKCkgPT4ge1xyXG4gIGNvbnN0IHVwbG9hZERhdGEgPSBhc3luYyAoZGF0YSkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgUVVSTCA9IHByb2Nlc3MuZW52LkRBVEFfVVJMICsgXCJhZGRBcnRpY2xlL2FkZFwiO1xyXG4gICAgICBsZXQgcmVzID0gYXdhaXQgZmV0Y2goUVVSTCwge1xyXG4gICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICAgICAgYm9keTogZGF0YSxcclxuICAgICAgfSk7XHJcbiAgICAgIGxldCByZXN1bHQgPSBhd2FpdCByZXMuanNvbigpO1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgbGV0IGtleXMgPSBPYmplY3Qua2V5cyhsb2NhbFN0b3JhZ2UpO1xyXG4gICAgICAgIGZvciAobGV0IGtleSBvZiBrZXlzKSB7XHJcbiAgICAgICAgICBpZiAoa2V5ICE9PSBcImF1dGhvci1uYW1lXCIgJiYga2V5ICE9PSBcImFydGljbGUta2V5XCIpIHtcclxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oa2V5KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IG9wZW5SZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oXCJhcnRpY2xlLXN0b3JlXCIsIDIpO1xyXG4gICAgICAgIG9wZW5SZXF1ZXN0Lm9uc3VjY2VzcyA9IGFzeW5jICgpID0+IHtcclxuICAgICAgICAgIGxldCBkYiA9IG9wZW5SZXF1ZXN0LnJlc3VsdDtcclxuICAgICAgICAgIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKFwicGhvdG9CdWZmZXJcIiwgXCJyZWFkd3JpdGVcIik7XHJcbiAgICAgICAgICBsZXQgc3RvcmUgPSB0eC5vYmplY3RTdG9yZShcInBob3RvQnVmZmVyXCIpO1xyXG4gICAgICAgICAgbGV0IGtleXMgPSBzdG9yZS5nZXRBbGxLZXlzKCk7XHJcbiAgICAgICAgICBrZXlzLm9uc3VjY2VzcyA9ICgpID0+IHtcclxuICAgICAgICAgICAga2V5cy5yZXN1bHQubWFwKChrZXkpID0+IHtcclxuICAgICAgICAgICAgICBpZiAoa2V5ICE9PSBcImFydGljbGUtYXV0aG9yLXBob3RvXCIpIHtcclxuICAgICAgICAgICAgICAgIHN0b3JlLmRlbGV0ZShrZXkpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJkZWxldGVcIik7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xyXG4gICAgICAgICAgfTtcclxuICAgICAgICB9O1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGFsZXJ0KHJlc3VsdCk7XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIGNvbnN0IHN1Ym1pdEZvcm0gPSAoZSkgPT4ge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgbGV0IGRhdGEgPSBuZXcgRm9ybURhdGEoZS50YXJnZXQpO1xyXG4gICAgbGV0IGNvbnRlbnQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImFydGljbGUtY29udGVudC1vYmplY3RcIik7XHJcblxyXG4gICAgbGV0IGZpbGVMaXN0ID0gSlNPTi5wYXJzZShjb250ZW50KS5maWx0ZXIoKGl0ZW0pID0+IGl0ZW0udHlwZSA9PT0gXCJwaG90b1wiKTtcclxuICAgIGZpbGVMaXN0LnB1c2goe1xyXG4gICAgICBrZXk6IFwiYXJ0aWNsZS1hdXRob3ItcGhvdG9cIixcclxuICAgIH0pO1xyXG4gICAgbGV0IG9wZW5SZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oXCJhcnRpY2xlLXN0b3JlXCIsIDIpO1xyXG4gICAgb3BlblJlcXVlc3Qub25zdWNjZXNzID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgICBsZXQgZGIgPSBvcGVuUmVxdWVzdC5yZXN1bHQ7XHJcbiAgICAgIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKFwicGhvdG9CdWZmZXJcIik7XHJcbiAgICAgIGxldCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKFwicGhvdG9CdWZmZXJcIik7XHJcbiAgICAgIGxldCByZXFzID0gZmlsZUxpc3QubWFwKFxyXG4gICAgICAgIChpdGVtKSA9PlxyXG4gICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgcGhvdG8gPSBzdG9yZS5nZXQoaXRlbS5rZXkpO1xyXG4gICAgICAgICAgICBwaG90by5vbnN1Y2Nlc3MgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgaWYgKHBob3RvLnJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSh7XHJcbiAgICAgICAgICAgICAgICAgIGZpbGU6IHBob3RvLnJlc3VsdC5maWxlLFxyXG4gICAgICAgICAgICAgICAgICBuYW1lOiBpdGVtLmtleSxcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZWplY3QoXCLmnInkuIDkuKrlm77niYfmnb/lnZfmsqHmnInmlofku7bjgILor7fkuIrkvKDmiJbmmK/liKDpmaTngrnov5nkuKrmnb/lnZdcIik7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgfSlcclxuICAgICAgKTtcclxuICAgICAgUHJvbWlzZS5hbGwocmVxcylcclxuICAgICAgICAudGhlbigoaXRlbXMpID0+IHtcclxuICAgICAgICAgIGl0ZW1zLm1hcCgoaXRlbSkgPT4ge1xyXG4gICAgICAgICAgICBkYXRhLmFwcGVuZChpdGVtLm5hbWUsIGl0ZW0uZmlsZSk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIGRhdGEuYXBwZW5kKFwiYXJ0aWNsZS1jb250ZW50LW1haW5cIiwgY29udGVudCk7XHJcbiAgICAgICAgICBkYXRhLmFwcGVuZChcImxpbmstY291bnRcIiwgTGlua0xpc3QubGVuZ3RoKTtcclxuICAgICAgICAgIHVwbG9hZERhdGEoZGF0YSk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goYWxlcnQpO1xyXG4gICAgfTtcclxuICB9O1xyXG5cclxuICBjb25zdCBbTGlua0xpc3QsIHNldExpbmtMaXN0XSA9IHVzZVN0YXRlKFtcImFcIl0pO1xyXG5cclxuICByZXR1cm4gKFxyXG4gICAgPD5cclxuICAgICAgPEhlYWQ+XHJcbiAgICAgICAgPHRpdGxlPue8luWGmeaWh+eroDwvdGl0bGU+XHJcbiAgICAgICAgPGxpbmtcclxuICAgICAgICAgIHJlbD1cInN0eWxlc2hlZXRcIlxyXG4gICAgICAgICAgaHJlZj1cImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vYm9vdHN0cmFwQDQuNC4xL2Rpc3QvY3NzL2Jvb3RzdHJhcC5taW4uY3NzXCJcclxuICAgICAgICAgIGludGVncml0eT1cInNoYTM4NC1Wa29vOHg0Q0dzTzMrSGh4djhUL1E1UGFYdGtLdHU2dWc1VE9lTlY2Z0JpRmVXUEdGTjlNdWhPZjIzUTlJZmpoXCJcclxuICAgICAgICAgIGNyb3Nzb3JpZ2luPVwiYW5vbnltb3VzXCJcclxuICAgICAgICA+PC9saW5rPlxyXG4gICAgICAgIDxsaW5rXHJcbiAgICAgICAgICByZWw9XCJzdHlsZXNoZWV0XCJcclxuICAgICAgICAgIGhyZWY9XCIvL2F0LmFsaWNkbi5jb20vdC9mb250XzE3NDg5MTlfN3AwMTM3NXhza3guY3NzXCJcclxuICAgICAgICAvPlxyXG4gICAgICAgIDxsaW5rIHJlbD1cImljb25cIiBocmVmPVwiL2xvZ28uanBnXCIgdHlwZT1cImltYWdlL3gtaWNvblwiPjwvbGluaz5cclxuICAgICAgPC9IZWFkPlxyXG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cImNvbnRhaW5lci1mbHVpZFwiPlxyXG4gICAgICAgIDxuYXY+XHJcbiAgICAgICAgICA8TmF2IC8+XHJcbiAgICAgICAgPC9uYXY+XHJcbiAgICAgICAgPGZvcm0gb25TdWJtaXQ9e3N1Ym1pdEZvcm19PlxyXG4gICAgICAgICAgPEF1dGhvciAvPlxyXG5cclxuICAgICAgICAgIDxBcnRDb250ZW50IHNldExpbmtMaXN0PXtzZXRMaW5rTGlzdH0gLz5cclxuXHJcbiAgICAgICAgICA8QWJvdXQgTGlzdD17TGlua0xpc3R9IC8+XHJcbiAgICAgICAgPC9mb3JtPlxyXG5cclxuICAgICAgICA8Rm9vdGVyIC8+XHJcbiAgICAgIDwvZGl2PlxyXG5cclxuICAgICAgPHN0eWxlIGpzeCBnbG9iYWw+e2BcclxuICAgICAgICAqLFxyXG4gICAgICAgIGJvZHkge1xyXG4gICAgICAgICAgbWFyZ2luOiAwO1xyXG4gICAgICAgICAgcGFkZGluZzogMDtcclxuICAgICAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGh0bWwge1xyXG4gICAgICAgICAgZm9udC1zaXplOiAxMHB4O1xyXG4gICAgICAgIH1cclxuICAgICAgICAuY29udGFpbmVyLWZsdWlkIHtcclxuICAgICAgICAgIHBhZGRpbmc6IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICBgfTwvc3R5bGU+XHJcbiAgICA8Lz5cclxuICApO1xyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgSG9tZTtcclxuIl19 */\\n/*@ sourceURL=C:\\\\\\\\newlife\\\\\\\\newSite\\\\\\\\my-app\\\\\\\\pages\\\\\\\\release-article.js */\"));\n};\n\nexport default Home;","map":{"version":3,"sources":["C:/newlife/newSite/my-app/pages/release-article.js"],"names":["React","useEffect","useState","Head","Nav","Author","ArtContent","About","Footer","useRouter","Home","uploadData","data","QURL","process","env","DATA_URL","fetch","method","body","res","json","result","ok","keys","Object","localStorage","key","removeItem","openRequest","indexedDB","open","onsuccess","db","tx","transaction","store","objectStore","getAllKeys","map","console","log","window","location","reload","alert","submitForm","e","preventDefault","FormData","target","content","getItem","fileList","JSON","parse","filter","item","type","push","reqs","Promise","resolve","reject","photo","get","file","name","all","then","items","append","LinkList","length","setLinkList"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\r\n\r\nimport Head from \"next/head\";\r\nimport Nav from \"../component/release-article/nav\";\r\nimport Author from \"../component/release-article/author\";\r\nimport ArtContent from \"../component/release-article/articleContent\";\r\nimport About from \"../component/release-article/about\";\r\nimport Footer from \"../component/release-article/footer\";\r\nimport { useRouter } from \"next/router\";\r\n\r\nconst Home = () => {\r\n  const uploadData = async (data) => {\r\n    try {\r\n      const QURL = process.env.DATA_URL + \"addArticle/add\";\r\n      let res = await fetch(QURL, {\r\n        method: \"POST\",\r\n        body: data,\r\n      });\r\n      let result = await res.json();\r\n      if (res.ok) {\r\n        let keys = Object.keys(localStorage);\r\n        for (let key of keys) {\r\n          if (key !== \"author-name\" && key !== \"article-key\") {\r\n            localStorage.removeItem(key);\r\n          }\r\n        }\r\n        let openRequest = indexedDB.open(\"article-store\", 2);\r\n        openRequest.onsuccess = async () => {\r\n          let db = openRequest.result;\r\n          let tx = db.transaction(\"photoBuffer\", \"readwrite\");\r\n          let store = tx.objectStore(\"photoBuffer\");\r\n          let keys = store.getAllKeys();\r\n          keys.onsuccess = () => {\r\n            keys.result.map((key) => {\r\n              if (key !== \"article-author-photo\") {\r\n                store.delete(key);\r\n                console.log(\"delete\");\r\n              }\r\n            });\r\n            window.location.reload();\r\n          };\r\n        };\r\n      } else {\r\n        alert(result);\r\n      }\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n\r\n  const submitForm = (e) => {\r\n    e.preventDefault();\r\n    let data = new FormData(e.target);\r\n    let content = localStorage.getItem(\"article-content-object\");\r\n\r\n    let fileList = JSON.parse(content).filter((item) => item.type === \"photo\");\r\n    fileList.push({\r\n      key: \"article-author-photo\",\r\n    });\r\n    let openRequest = indexedDB.open(\"article-store\", 2);\r\n    openRequest.onsuccess = async () => {\r\n      let db = openRequest.result;\r\n      let tx = db.transaction(\"photoBuffer\");\r\n      let store = tx.objectStore(\"photoBuffer\");\r\n      let reqs = fileList.map(\r\n        (item) =>\r\n          new Promise((resolve, reject) => {\r\n            let photo = store.get(item.key);\r\n            photo.onsuccess = () => {\r\n              if (photo.result) {\r\n                resolve({\r\n                  file: photo.result.file,\r\n                  name: item.key,\r\n                });\r\n              } else {\r\n                reject(\"有一个图片板块没有文件。请上传或是删除点这个板块\");\r\n              }\r\n            };\r\n          })\r\n      );\r\n      Promise.all(reqs)\r\n        .then((items) => {\r\n          items.map((item) => {\r\n            data.append(item.name, item.file);\r\n          });\r\n          data.append(\"article-content-main\", content);\r\n          data.append(\"link-count\", LinkList.length);\r\n          uploadData(data);\r\n        })\r\n        .catch(alert);\r\n    };\r\n  };\r\n\r\n  const [LinkList, setLinkList] = useState([\"a\"]);\r\n\r\n  return (\r\n    <>\r\n      <Head>\r\n        <title>编写文章</title>\r\n        <link\r\n          rel=\"stylesheet\"\r\n          href=\"https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css\"\r\n          integrity=\"sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh\"\r\n          crossorigin=\"anonymous\"\r\n        ></link>\r\n        <link\r\n          rel=\"stylesheet\"\r\n          href=\"//at.alicdn.com/t/font_1748919_7p01375xskx.css\"\r\n        />\r\n        <link rel=\"icon\" href=\"/logo.jpg\" type=\"image/x-icon\"></link>\r\n      </Head>\r\n      <div className=\"container-fluid\">\r\n        <nav>\r\n          <Nav />\r\n        </nav>\r\n        <form onSubmit={submitForm}>\r\n          <Author />\r\n\r\n          <ArtContent setLinkList={setLinkList} />\r\n\r\n          <About List={LinkList} />\r\n        </form>\r\n\r\n        <Footer />\r\n      </div>\r\n\r\n      <style jsx global>{`\r\n        *,\r\n        body {\r\n          margin: 0;\r\n          padding: 0;\r\n          box-sizing: border-box;\r\n        }\r\n        html {\r\n          font-size: 10px;\r\n        }\r\n        .container-fluid {\r\n          padding: 0;\r\n        }\r\n      `}</style>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Home;\r\n"]},"metadata":{},"sourceType":"module"}