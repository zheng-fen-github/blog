{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nvar _this = this,\n    _jsxFileName = \"C:\\\\newlife\\\\newSite\\\\my-app\\\\component\\\\home\\\\photo.js\";\n\nimport _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nimport React, { useEffect, useState } from \"react\";\n\nvar Photo = function Photo(_ref) {\n  var id = _ref.id,\n      name = _ref.name,\n      classname = _ref.classname;\n\n  var _useState = useState(null),\n      bolb = _useState[0],\n      setBolb = _useState[1];\n\n  var _useState2 = useState(false),\n      error = _useState2[0],\n      setError = _useState2[1];\n\n  var _useState3 = useState(false),\n      load = _useState3[0],\n      setLoad = _useState3[1];\n\n  var getphoto = function getphoto() {\n    var QURL, get, blob, img;\n    return _regeneratorRuntime.async(function getphoto$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            QURL = process.env.DATA_URL + \"addphoto/getphoto/\" + id;\n            setLoad(true);\n            _context.next = 5;\n            return _regeneratorRuntime.awrap(fetch(QURL));\n\n          case 5:\n            get = _context.sent;\n\n            if (!get.ok) {\n              _context.next = 13;\n              break;\n            }\n\n            _context.next = 9;\n            return _regeneratorRuntime.awrap(get.blob());\n\n          case 9:\n            blob = _context.sent;\n            img = document.createElement(\"img\");\n            img.src = URL.createObjectURL(blob);\n\n            img.onload = function () {\n              document.querySelector(\".photo-container\").append(img);\n              canvasFunc(img.offsetWidth, img.offsetHeight, img, setBolb);\n              setLoad(false);\n            };\n\n          case 13:\n            _context.next = 20;\n            break;\n\n          case 15:\n            _context.prev = 15;\n            _context.t0 = _context[\"catch\"](0);\n            console.log(_context.t0);\n            setError(true);\n            setLoad(false);\n\n          case 20:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[0, 15]], Promise);\n  };\n\n  useEffect(function () {\n    getphoto();\n  }, [id]);\n  return __jsx(React.Fragment, null, bolb && __jsx(\"img\", {\n    src: URL.createObjectURL(bolb),\n    alt: name,\n    className: \"jsx-2887014874\" + \" \" + \"w-100\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 34,\n      columnNumber: 9\n    }\n  }), load && __jsx(\"div\", {\n    className: \"jsx-2887014874\" + \" \" + (\"loading \" + classname || \"\"),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 36,\n      columnNumber: 16\n    }\n  }), error && __jsx(\"h2\", {\n    className: \"jsx-2887014874\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 37,\n      columnNumber: 17\n    }\n  }, \" \\u52A0\\u8F7D\\u56FE\\u7247\\u5931\\u8D25 \"), __jsx(\"div\", {\n    style: {\n      position: \"fixed\",\n      left: 0,\n      top: 0,\n      visibility: \"hidden\",\n      userSelect: \"none\"\n    },\n    className: \"jsx-2887014874\" + \" \" + \"photo-container\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 38,\n      columnNumber: 7\n    }\n  }), __jsx(\"canvas\", {\n    id: \"canvas\",\n    hidden: true,\n    className: \"jsx-2887014874\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 48,\n      columnNumber: 7\n    }\n  }), __jsx(_JSXStyle, {\n    id: \"2887014874\",\n    __self: _this\n  }, \".loading.jsx-2887014874{width:100%;height:20px;background:black;height:20vh;-webkit-animation:show-jsx-2887014874 2s infinite;animation:show-jsx-2887014874 2s infinite;z-index:99;}.right.jsx-2887014874{height:44vh;}@-webkit-keyframes show-jsx-2887014874{0%{background:black;}50%{background:#cbcbcb;}100%{background:black;}}@keyframes show-jsx-2887014874{0%{background:black;}50%{background:#cbcbcb;}100%{background:black;}}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxuZXdsaWZlXFxuZXdTaXRlXFxteS1hcHBcXGNvbXBvbmVudFxcaG9tZVxccGhvdG8uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBa0RTLEFBR3dCLEFBUUMsQUFJTyxBQUdFLEFBR0YsV0FqQlAsQ0FRZCxLQUlFLEFBTUEsRUFIQSxJQWRpQixpQkFDTCxZQUNlLDRGQUNoQixXQUNiIiwiZmlsZSI6IkM6XFxuZXdsaWZlXFxuZXdTaXRlXFxteS1hcHBcXGNvbXBvbmVudFxcaG9tZVxccGhvdG8uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgdXNlRWZmZWN0LCB1c2VTdGF0ZSB9IGZyb20gXCJyZWFjdFwiO1xyXG5cclxuY29uc3QgUGhvdG8gPSAoeyBpZCwgbmFtZSwgY2xhc3NuYW1lIH0pID0+IHtcclxuICBjb25zdCBbYm9sYiwgc2V0Qm9sYl0gPSB1c2VTdGF0ZShudWxsKTtcclxuICBjb25zdCBbZXJyb3IsIHNldEVycm9yXSA9IHVzZVN0YXRlKGZhbHNlKTtcclxuICBjb25zdCBbbG9hZCwgc2V0TG9hZF0gPSB1c2VTdGF0ZShmYWxzZSk7XHJcbiAgY29uc3QgZ2V0cGhvdG8gPSBhc3luYyAoKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBRVVJMID0gcHJvY2Vzcy5lbnYuREFUQV9VUkwgKyBcImFkZHBob3RvL2dldHBob3RvL1wiICsgaWQ7XHJcbiAgICAgIHNldExvYWQodHJ1ZSk7XHJcbiAgICAgIGxldCBnZXQgPSBhd2FpdCBmZXRjaChRVVJMKTtcclxuICAgICAgaWYgKGdldC5vaykge1xyXG4gICAgICAgIGxldCBibG9iID0gYXdhaXQgZ2V0LmJsb2IoKTtcclxuICAgICAgICBsZXQgaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImltZ1wiKTtcclxuICAgICAgICBpbWcuc3JjID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcclxuICAgICAgICBpbWcub25sb2FkID0gKCkgPT4ge1xyXG4gICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5waG90by1jb250YWluZXJcIikuYXBwZW5kKGltZyk7XHJcbiAgICAgICAgICBjYW52YXNGdW5jKGltZy5vZmZzZXRXaWR0aCwgaW1nLm9mZnNldEhlaWdodCwgaW1nLCBzZXRCb2xiKTtcclxuICAgICAgICAgIHNldExvYWQoZmFsc2UpO1xyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gICAgICBzZXRFcnJvcih0cnVlKTtcclxuICAgICAgc2V0TG9hZChmYWxzZSk7XHJcbiAgICB9XHJcbiAgfTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgZ2V0cGhvdG8oKTtcclxuICB9LCBbaWRdKTtcclxuICByZXR1cm4gKFxyXG4gICAgPD5cclxuICAgICAge2JvbGIgJiYgKFxyXG4gICAgICAgIDxpbWcgc3JjPXtVUkwuY3JlYXRlT2JqZWN0VVJMKGJvbGIpfSBhbHQ9e25hbWV9IGNsYXNzTmFtZT1cInctMTAwXCIgLz5cclxuICAgICAgKX1cclxuICAgICAge2xvYWQgJiYgPGRpdiBjbGFzc05hbWU9e1wibG9hZGluZyBcIiArIGNsYXNzbmFtZX0+PC9kaXY+fVxyXG4gICAgICB7ZXJyb3IgJiYgPGgyPiDliqDovb3lm77niYflpLHotKUgPC9oMj59XHJcbiAgICAgIDxkaXZcclxuICAgICAgICBjbGFzc05hbWU9XCJwaG90by1jb250YWluZXJcIlxyXG4gICAgICAgIHN0eWxlPXt7XHJcbiAgICAgICAgICBwb3NpdGlvbjogXCJmaXhlZFwiLFxyXG4gICAgICAgICAgbGVmdDogMCxcclxuICAgICAgICAgIHRvcDogMCxcclxuICAgICAgICAgIHZpc2liaWxpdHk6IFwiaGlkZGVuXCIsXHJcbiAgICAgICAgICB1c2VyU2VsZWN0OiBcIm5vbmVcIixcclxuICAgICAgICB9fVxyXG4gICAgICA+PC9kaXY+XHJcbiAgICAgIDxjYW52YXMgaWQ9XCJjYW52YXNcIiBoaWRkZW4+PC9jYW52YXM+XHJcblxyXG4gICAgICA8c3R5bGUganN4PlxyXG4gICAgICAgIHtgXHJcbiAgICAgICAgICAubG9hZGluZyB7XHJcbiAgICAgICAgICAgIHdpZHRoOiAxMDAlO1xyXG4gICAgICAgICAgICBoZWlnaHQ6IDIwcHg7XHJcbiAgICAgICAgICAgIGJhY2tncm91bmQ6IGJsYWNrO1xyXG4gICAgICAgICAgICBoZWlnaHQ6IDIwdmg7XHJcbiAgICAgICAgICAgIGFuaW1hdGlvbjogc2hvdyAycyBpbmZpbml0ZTtcclxuICAgICAgICAgICAgei1pbmRleDogOTk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICAucmlnaHQge1xyXG4gICAgICAgICAgICBoZWlnaHQ6IDQ0dmg7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBAa2V5ZnJhbWVzIHNob3cge1xyXG4gICAgICAgICAgICAwJSB7XHJcbiAgICAgICAgICAgICAgYmFja2dyb3VuZDogYmxhY2s7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgNTAlIHtcclxuICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAjY2JjYmNiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIDEwMCUge1xyXG4gICAgICAgICAgICAgIGJhY2tncm91bmQ6IGJsYWNrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgYH1cclxuICAgICAgPC9zdHlsZT5cclxuICAgIDwvPlxyXG4gICk7XHJcbn07XHJcblxyXG5jb25zdCBjYW52YXNGdW5jID0gKFcsIEgsIGltZywgbG9hZFBob3RvKSA9PiB7XHJcbiAgbGV0IGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY2FudmFzXCIpO1xyXG4gIGxldCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xyXG4gIGxldCBjb3VudCA9IE1hdGgubWluKFcsIEgpO1xyXG4gIGNhbnZhcy53aWR0aCA9IGNvdW50O1xyXG4gIGNhbnZhcy5oZWlnaHQgPSBjb3VudDtcclxuICBsZXQgdyA9IChNYXRoLm1heChXLCBIKSAtIGNvdW50KSAvIDI7XHJcbiAgVyA+IEggPyBjdHguZHJhd0ltYWdlKGltZywgLXcsIDApIDogY3R4LmRyYXdJbWFnZShpbWcsIDAsIC13KTsgLy/oo4Hlh4/miJDkuIDmr5TkuIBcclxuICBjYW52YXMudG9CbG9iKChibG9iKSA9PiB7XHJcbiAgICAvLyDovpPlh7rlm77niYdcclxuICAgIGxvYWRQaG90byhibG9iKTtcclxuICB9LCBcImltYWdlL3BuZ1wiKTtcclxufTtcclxuZXhwb3J0IGRlZmF1bHQgUGhvdG87XHJcbiJdfQ== */\\n/*@ sourceURL=C:\\\\\\\\newlife\\\\\\\\newSite\\\\\\\\my-app\\\\\\\\component\\\\\\\\home\\\\\\\\photo.js */\"));\n};\n\nvar canvasFunc = function canvasFunc(W, H, img, loadPhoto) {\n  var canvas = document.getElementById(\"canvas\");\n  var ctx = canvas.getContext(\"2d\");\n  var count = Math.min(W, H);\n  canvas.width = count;\n  canvas.height = count;\n  var w = (Math.max(W, H) - count) / 2;\n  W > H ? ctx.drawImage(img, -w, 0) : ctx.drawImage(img, 0, -w); //裁减成一比一\n\n  canvas.toBlob(function (blob) {\n    // 输出图片\n    loadPhoto(blob);\n  }, \"image/png\");\n};\n\nexport default Photo;","map":{"version":3,"sources":["C:/newlife/newSite/my-app/component/home/photo.js"],"names":["React","useEffect","useState","Photo","id","name","classname","bolb","setBolb","error","setError","load","setLoad","getphoto","QURL","process","env","DATA_URL","fetch","get","ok","blob","img","document","createElement","src","URL","createObjectURL","onload","querySelector","append","canvasFunc","offsetWidth","offsetHeight","console","log","position","left","top","visibility","userSelect","W","H","loadPhoto","canvas","getElementById","ctx","getContext","count","Math","min","width","height","w","max","drawImage","toBlob"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\r\n\r\nconst Photo = ({ id, name, classname }) => {\r\n  const [bolb, setBolb] = useState(null);\r\n  const [error, setError] = useState(false);\r\n  const [load, setLoad] = useState(false);\r\n  const getphoto = async () => {\r\n    try {\r\n      const QURL = process.env.DATA_URL + \"addphoto/getphoto/\" + id;\r\n      setLoad(true);\r\n      let get = await fetch(QURL);\r\n      if (get.ok) {\r\n        let blob = await get.blob();\r\n        let img = document.createElement(\"img\");\r\n        img.src = URL.createObjectURL(blob);\r\n        img.onload = () => {\r\n          document.querySelector(\".photo-container\").append(img);\r\n          canvasFunc(img.offsetWidth, img.offsetHeight, img, setBolb);\r\n          setLoad(false);\r\n        };\r\n      }\r\n    } catch (err) {\r\n      console.log(err);\r\n      setError(true);\r\n      setLoad(false);\r\n    }\r\n  };\r\n  useEffect(() => {\r\n    getphoto();\r\n  }, [id]);\r\n  return (\r\n    <>\r\n      {bolb && (\r\n        <img src={URL.createObjectURL(bolb)} alt={name} className=\"w-100\" />\r\n      )}\r\n      {load && <div className={\"loading \" + classname}></div>}\r\n      {error && <h2> 加载图片失败 </h2>}\r\n      <div\r\n        className=\"photo-container\"\r\n        style={{\r\n          position: \"fixed\",\r\n          left: 0,\r\n          top: 0,\r\n          visibility: \"hidden\",\r\n          userSelect: \"none\",\r\n        }}\r\n      ></div>\r\n      <canvas id=\"canvas\" hidden></canvas>\r\n\r\n      <style jsx>\r\n        {`\r\n          .loading {\r\n            width: 100%;\r\n            height: 20px;\r\n            background: black;\r\n            height: 20vh;\r\n            animation: show 2s infinite;\r\n            z-index: 99;\r\n          }\r\n          .right {\r\n            height: 44vh;\r\n          }\r\n          @keyframes show {\r\n            0% {\r\n              background: black;\r\n            }\r\n            50% {\r\n              background: #cbcbcb;\r\n            }\r\n            100% {\r\n              background: black;\r\n            }\r\n          }\r\n        `}\r\n      </style>\r\n    </>\r\n  );\r\n};\r\n\r\nconst canvasFunc = (W, H, img, loadPhoto) => {\r\n  let canvas = document.getElementById(\"canvas\");\r\n  let ctx = canvas.getContext(\"2d\");\r\n  let count = Math.min(W, H);\r\n  canvas.width = count;\r\n  canvas.height = count;\r\n  let w = (Math.max(W, H) - count) / 2;\r\n  W > H ? ctx.drawImage(img, -w, 0) : ctx.drawImage(img, 0, -w); //裁减成一比一\r\n  canvas.toBlob((blob) => {\r\n    // 输出图片\r\n    loadPhoto(blob);\r\n  }, \"image/png\");\r\n};\r\nexport default Photo;\r\n"]},"metadata":{},"sourceType":"module"}