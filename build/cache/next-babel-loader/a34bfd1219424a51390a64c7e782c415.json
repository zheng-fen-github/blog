{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nimport React, { useEffect, useState } from \"react\";\nimport CommentList from \"./domList\";\n\nvar Comment = function Comment(_ref) {\n  var message = _ref.message,\n      id = _ref.id;\n  useEffect(function () {\n    //获取用户信息\n    var userId = localStorage.getItem(\"user-id\");\n    var userName = localStorage.getItem(\"user-name\");\n\n    if (!userId) {\n      userId = \"youke\" + Date.now();\n      localStorage.setItem(\"user-id\", userId);\n    }\n\n    if (!userName) {\n      userName = \"游客\" + String(Date.now()).slice(-5);\n      localStorage.setItem(\"user-name\", userName);\n    }\n\n    setUserName(userName);\n  }, []);\n\n  var _useState = useState(null),\n      userName = _useState[0],\n      setUserName = _useState[1];\n\n  var changeUserName = function changeUserName(e) {\n    //用户自定义名字\n    var value = e.target.value;\n    setUserName(value);\n    localStorage.setItem(\"user-name\", value);\n  };\n\n  var submitEvent = function submitEvent(e) {\n    var data, QURL, res, result, textDom;\n    return _regeneratorRuntime.async(function submitEvent$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            e.preventDefault();\n            data = new FormData(e.target);\n            QURL = process.env.DATA_URL + \"addArticle/articleComment/\" + id;\n            _context.next = 6;\n            return _regeneratorRuntime.awrap(fetch(QURL, {\n              method: \"POST\",\n              body: data\n            }));\n\n          case 6:\n            res = _context.sent;\n\n            if (!res.ok) {\n              _context.next = 16;\n              break;\n            }\n\n            _context.next = 10;\n            return _regeneratorRuntime.awrap(res.json());\n\n          case 10:\n            result = _context.sent;\n            setState(result);\n            textDom = document.getElementById(\"comment\");\n            textDom.value = \"\";\n            _context.next = 18;\n            break;\n\n          case 16:\n            alert(\"添加出错，服务器去看妹子了。\");\n            console.log(error);\n\n          case 18:\n            _context.next = 23;\n            break;\n\n          case 20:\n            _context.prev = 20;\n            _context.t0 = _context[\"catch\"](0);\n            console.log(_context.t0);\n\n          case 23:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[0, 20]], Promise);\n  };\n\n  var inputAutoHeight = function inputAutoHeight(e) {\n    var dom = e.target; // 内容高度自动适应\n\n    dom.style.height = dom.scrollHeight > dom.offsetHeight ? dom.scrollHeight + 10 + \"px\" : dom.offsetHeight + \"px\";\n  };\n\n  var _useState2 = useState(message.slice(0, 3)),\n      state = _useState2[0],\n      setState = _useState2[1]; //评论列表\n  //   let domList = state.map((item) => (\n  //     <div className=\"col-12\" key={item.createTime}>\n  //       <div className=\"row\">\n  //         <h3>{item.username + \" : \" + item.message}</h3>\n  //       </div>\n  //     </div>\n  //   ));\n\n\n  return __jsx(\"form\", {\n    onSubmit: submitEvent,\n    className: \"jsx-2726780744\" + \" \" + \"row comment m-0 p-0 justify-content-center\"\n  }, __jsx(\"div\", {\n    className: \"jsx-2726780744\" + \" \" + \"col-10 col-lg-8 \"\n  }, __jsx(\"div\", {\n    className: \"jsx-2726780744\" + \" \" + \"row justify-content-between \"\n  }, __jsx(\"h2\", {\n    className: \"jsx-2726780744\" + \" \" + \"comment-item m-0 py-3\"\n  }, message.length, \" \\u8BC4\\u8BBA\"), __jsx(\"input\", {\n    type: \"text\",\n    name: \"username\",\n    value: userName ? userName : \"\",\n    onInput: changeUserName,\n    onChange: changeUserName,\n    id: \"username\",\n    className: \"jsx-2726780744\" + \" \" + \"px-4 usename text-center\"\n  })), __jsx(\"div\", {\n    className: \"jsx-2726780744\" + \" \" + \"row mt-5 align-items-center\"\n  }, __jsx(\"textarea\", {\n    type: \"text\",\n    name: \"message\",\n    id: \"comment\",\n    onInput: inputAutoHeight,\n    className: \"jsx-2726780744\" + \" \" + \"col px-4 py-2\"\n  }), __jsx(\"button\", {\n    type: \"submit\",\n    className: \"jsx-2726780744\"\n  }, __jsx(\"i\", {\n    className: \"jsx-2726780744\" + \" \" + \"iconfont icon-cloud-upload col-auto\"\n  }))), __jsx(\"div\", {\n    style: {\n      padding: \"20px 80px\"\n    },\n    className: \"jsx-2726780744\" + \" \" + \"row comment-list justify-content-center align-items-center position-relative\"\n  }, message.length > 0 ? __jsx(CommentList, {\n    list: state\n  }) : __jsx(\"h3\", {\n    className: \"jsx-2726780744\"\n  }, \" \\u505A\\u7B2C\\u4E00\\u4E2A\\u8BC4\\u8BBA\\uFF1F \"))), __jsx(_JSXStyle, {\n    id: \"2726780744\"\n  }, [\".comment.jsx-2726780744{padding:10rem 0;}\", \"h2.jsx-2726780744{font-weight:700;}\", \".look-more.jsx-2726780744{right:70px;top:10px;color:#007bff;cursor:pointer;}\", \"i.jsx-2726780744{font-size:40px;cursor:pointer;-webkit-transition:0.2s;transition:0.2s;}\", \"i.jsx-2726780744:hover{color:#007bff;}\", \".col-8.jsx-2726780744>.row.jsx-2726780744:nth-child(1){border-bottom:2px solid #eaeaea;}\", \"img.jsx-2726780744{height:40px;border-radius:50%;}\", \".comment-item.jsx-2726780744{border-bottom:2px solid black;position:relative;top:2px;}\", \".comment-list.jsx-2726780744{min-height:20vh;border-bottom:2px solid #eaeaea;}\", \"input.jsx-2726780744,textarea.jsx-2726780744{font-size:2rem;font-weight:500;}\", \"input[name=\\\"username\\\"].jsx-2726780744{border:none;}\", \"button.jsx-2726780744{background:none;border:none;}\"]));\n};\n\nexport default Comment;","map":null,"metadata":{},"sourceType":"module"}